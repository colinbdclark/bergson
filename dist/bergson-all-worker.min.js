/*! Bergson 0.12.0, Copyright 2016 Colin Clark | github.com/colinbdclark/bergson */

var fluid_2_0_0=fluid_2_0_0||{},fluid=fluid||fluid_2_0_0;!function(a){"use strict";var b=Object.prototype.toString,c=Object.prototype.hasOwnProperty,d="undefined"!=typeof window?window:"undefined"!=typeof self?self:global,e=d.jQuery,f=d.$,g=a.jQueryStandalone={jquery:"1.6.1-fluidStandalone",noConflict:function(a){return d.$===g&&(d.$=f),a&&d.jQuery===g&&(d.jQuery=e),g},isArray:Array.isArray||function(a){return"[object Array]"===b.call(a)},isWindow:function(a){return a&&"object"==typeof a&&"setInterval"in a},isPlainObject:function(a){if(!a||"[object Object]"!==b.call(a)||a.nodeType||g.isWindow(a))return!1;if(a.constructor&&!c.call(a,"constructor")&&!c.call(a.constructor.prototype,"isPrototypeOf"))return!1;var d;for(d in a);return void 0===d||c.call(a,d)},trim:function(a){return a.trim()},isEmptyObject:function(a){var b;for(b in a)return!1;return!0},extend:function(){var a,b=arguments[0]||{},c=1,d=arguments.length,e=!1;for("boolean"==typeof b&&(e=b,b=arguments[1]||{},c=2),"object"!=typeof b&&"function"!=typeof b&&(b={});d>c;c++)if(null!==(a=arguments[c]))for(var f in a){var h=b[f],i=a[f];if(b!==i){var j,k;e&&i&&(g.isPlainObject(i)||(j=g.isArray(i)))?(j?(j=!1,k=h&&g.isArray(h)?h:[]):k=h&&g.isPlainObject(h)?h:{},b[f]=g.extend(e,k,i)):void 0!==i&&(b[f]=i)}}return b}}}(fluid_2_0_0);var jQuery=fluid.jQueryStandalone,fluid_2_0_0=fluid_2_0_0||{},fluid=fluid||fluid_2_0_0;!function(a,b){"use strict";function c(a,b,c,d){for(var e=a[c],f=0;f<d.length-1;++f)e=d[f+1](e,c);b[c]=e}function d(a,c,d,e){for(var f=0;d>f;++f)a=e(a,c[f],f,b.makeArray(c));return a}function e(a,b,c,e){for(var f=[],g=0;g<a.length;++g){var h=d(a[g],b,c,e[g]);void 0!==h&&f.push(h)}return f}b.version="Infusion 2.0.0",b.Error=Error,b.environment={fluid:b},b.global=b.global||"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},b.invokeLater=function(a){return setTimeout(a,1)},b.defeatLogging=!0,b.activityTracing=!1,b.activityTrace=[];var f=/(%\w+)/g;b.renderOneActivity=function(a,b){for(var c=b===!0?[]:["    while "],d=a.message,e=f.lastIndex=0;;){var g=f.exec(d);if(!g)break;var h=g[1].substring(1);c.push(d.substring(e,g.index)),c.push(a.args[h]),e=f.lastIndex}return e<d.length&&c.push(d.substring(e)),c},b.renderActivity=function(a,c){return c=c||b.renderOneActivity,b.transform(a,c)},b.singleThreadLocal=function(a){var b=a();return function(a){return void 0===a?b:b=a}},b.threadLocal=b.singleThreadLocal,b.globalThreadLocal=b.threadLocal(function(){return{}}),b.getActivityStack=function(){var a=b.globalThreadLocal();return a.activityStack||(a.activityStack=[]),a.activityStack},b.describeActivity=b.getActivityStack,b.logActivity=function(a){a=a||b.describeActivity();var c=b.renderActivity(a).reverse();b.log("Current activity: "),b.each(c,function(a){b.doLog(a)})},b.pushActivity=function(a,c,d){var e={type:a,message:c,args:d,time:(new Date).getTime()};b.activityTracing&&b.activityTrace.push(e),b.passLogLevel(b.logLevel.TRACE)&&b.doLog(b.renderOneActivity(e,!0));var f=b.getActivityStack();f.push(e)},b.popActivity=function(a){a=a||1,b.activityTracing&&b.activityTrace.push({pop:a});var c=b.getActivityStack(),d=c.length-a;c.length=0>d?0:d},b.FluidError=function(){var a=Error.apply(this,arguments);this.message=a.message;try{throw a}catch(a){this.stack=a.stack}return this},b.FluidError.prototype=Object.create(Error.prototype),b.logFailure=function(a,c){b.log.apply(null,[b.logLevel.FAIL,"ASSERTION FAILED: "].concat(a)),b.logActivity(c)},b.renderLoggingArg=function(a){return b.isPrimitive(a)||!b.isPlainObject(a)?a:JSON.stringify(a)},b.builtinFail=function(a){var c=b.transform(a,b.renderLoggingArg).join("");throw new b.FluidError("Assertion failure - check console for more details: "+c)},b.fail=function(){var a=b.makeArray(arguments),c=b.makeArray(b.describeActivity());b.popActivity(c.length),b.failureEvent?b.failureEvent.fire(a,c):(b.logFailure(a,c),b.builtinFail(a,c))},b.expect=function(a,c,d){b.transform(b.makeArray(d),function(d){"undefined"==typeof c[d]&&b.fail(a+" missing required parameter "+d)})},b.isLogging=function(){return g[0].priority>b.logLevel.IMPORTANT.priority},b.isLogLevel=function(a){return b.isMarker(a)&&void 0!==a.priority},b.passLogLevel=function(a){return a.priority<=g[0].priority},b.setLogging=function(a){var c;"boolean"==typeof a?c=b.logLevel[a?"INFO":"IMPORTANT"]:b.isLogLevel(a)?c=a:b.fail("Unrecognised fluid logging level ",a),g.unshift(c),b.defeatLogging=!b.isLogging()},b.setLogLevel=b.setLogging,b.popLogging=function(){var a=1===g.length?g[0]:g.shift();return b.defeatLogging=!b.isLogging(),a},b.doLog=function(a){"undefined"!=typeof console&&(console.debug?console.debug.apply(console,a):"function"==typeof console.log&&console.log.apply(console,a))},b.log=function(){var a=b.makeArray(arguments),c=b.logLevel.INFO;if(b.isLogLevel(a[0])&&(c=a.shift()),b.passLogLevel(c)){var d=b.renderTimestamp(new Date)+":  ",e=[d].concat(a);b.doLog(e)}},b.isValue=function(a){return void 0!==a&&null!==a},b.isPrimitive=function(a){var b=typeof a;return!a||"string"===b||"boolean"===b||"number"===b||"function"===b},b.isArrayable=function(a){return a&&(a.jquery||"[object Array]"===Object.prototype.toString.call(a))},b.isPlainObject=function(a){var b=Object.prototype.toString.call(a);return"[object Array]"===b?!0:"[object Object]"!==b?!1:!a.constructor||!a.constructor.prototype||Object.prototype.hasOwnProperty.call(a.constructor.prototype,"isPrototypeOf")},b.typeCode=function(a){return b.isPrimitive(a)||!b.isPlainObject(a)?"primitive":b.isArrayable(a)?"array":"object"},b.isDOMNode=function(a){return a&&"number"==typeof a.nodeType},b.isComponent=function(a){return a&&a.constructor===b.componentConstructor},b.identity=function(a){return a},b.notImplemented=function(){b.fail("This operation is not implemented")},b.freshContainer=function(a){return b.isArrayable(a)?[]:{}},b.isUncopyable=function(a){return b.isPrimitive(a)||!b.isPlainObject(a)},b.copyRecurse=function(a,c){return c.length>b.strategyRecursionBailout&&b.fail("Runaway recursion encountered in fluid.copy - reached path depth of "+b.strategyRecursionBailout+" via path of "+c.join(".")+"this object is probably circularly connected. Either adjust your object structure to remove the circularity or increase fluid.strategyRecursionBailout"),b.isUncopyable(a)?a:b.transform(a,function(a,d){c.push(d);var e=b.copyRecurse(a,c);return c.pop(),e})},b.copy=function(a){return b.copyRecurse(a,[])},b.extend=a.extend,b.makeArray=function(a){var c=[];if(null!==a&&void 0!==a)if(b.isPrimitive(a)||"number"!=typeof a.length)c.push(a);else for(var d=0;d<a.length;++d)c[d]=a[d];return c},b.pushArray=function(a,c,d){var e=a[c]?a[c]:a[c]=[];b.isArrayable(d)?e.push.apply(e,d):e.push(d)},b.transform=function(a){if(b.isPrimitive(a))return a;var d=b.freshContainer(a);if(b.isArrayable(a))for(var e=0;e<a.length;++e)c(a,d,e,arguments);else for(var f in a)c(a,d,f,arguments);return d},b.each=function(a,c){if(b.isArrayable(a))for(var d=0;d<a.length;++d)c(a[d],d);else for(var e in a)c(a[e],e)},b.make_find=function(a){var c=a?!1:void 0;return function(d,e,f){var g;if(b.isArrayable(d)){for(var h=0;h<d.length;++h)if(g=e(d[h],h),g!==c)return a?d[h]:g}else for(var i in d)if(g=e(d[i],i),g!==c)return a?d[i]:g;return f}},b.find=b.make_find(!1),b.find_if=b.make_find(!0),b.accumulate=function(a,b,c){for(var d=0;d<a.length;++d)c=b(a[d],c,d);return c},b.add=function(a,b){return a+b},b.remove_if=function(a,c,d){if(b.isArrayable(a))for(var e=a.length-1;e>=0;--e)c(a[e],e)&&(d&&d.unshift(a[e]),a.splice(e,1));else for(var f in a)c(a[f],f)&&(d&&(d[f]=a[f]),delete a[f]);return d||a},b.generate=function(a,b,c){for(var d=[],e=0;a>e;++e)d[e]=c?b(e):b;return d},b.iota=function(a,b){b=b||0;for(var c=[],d=0;a>d;++d)c[c.length]=b++;return c},b.getMembers=function(a,c){return b.transform(a,function(a){return b.get(a,c)})},b.filterKeys=function(c,d,e){return b.remove_if(a.extend({},c),function(a,b){return e^-1===d.indexOf(b)})},b.censorKeys=function(a,c){return b.filterKeys(a,c,!0)},b.makeFlatten=function(a){return function(c){var d=[];return b.each(c,function(){d.push(arguments[a])}),d}},b.keys=b.makeFlatten(1),b.values=b.makeFlatten(0),b.contains=function(a,c){return a?b.isArrayable(a)?-1!==a.indexOf(c):b.find(a,function(a){return c===a?!0:void 0}):void 0},b.keyForValue=function(a,c){return b.find(a,function(a,b){return c===a?b:void 0})},b.arrayToHash=function(a){var c={};return b.each(a,function(a){c[a]=!0}),c},b.stableSort=function(a,b){for(var c=0;c<a.length;c++){for(var d=a[c],e=c;e>0&&b(d,a[e-1])<0;e--)a[e]=a[e-1];a[e]=d}},b.hashToArray=function(c,d,e){var f=[];return b.each(c,function(b,c){var g={};g[d]=c,e?g=e(g,b,c)||g:a.extend(!0,g,b),f.push(g)}),f},b.flatten=function(a){var c=[];return b.each(a,function(a){b.isArrayable(a)?c=c.concat(a):c.push(a)}),c},b.clear=function(a){if(b.isArrayable(a))a.length=0;else for(var c in a)delete a[c]},b.compareStringLength=function(a){return a?function(a,b){return a.length-b.length}:function(a,b){return b.length-a.length}},b.parseInteger=function(a){return isFinite(a)&&a%1===0?Number(a):NaN},b.freezeRecursive=function(a){return b.each(a,function(a){b.freezeRecursive(a)}),b.isPlainObject(a)?Object.freeze(a):a},b.marker=function(){},b.makeMarker=function(c,d){var e=Object.create(b.marker.prototype);return e.value=c,a.extend(e,d),Object.freeze(e)},b.VALUE=b.makeMarker("VALUE"),b.NO_VALUE=b.makeMarker("NO_VALUE"),b.EXPAND=b.makeMarker("EXPAND"),b.isMarker=function(a,c){return a instanceof b.marker?c?a.value===c.value:!0:!1},b.logLevelsSpec={FATAL:0,FAIL:5,WARN:10,IMPORTANT:12,INFO:15,TRACE:20},b.logLevel=b.transform(b.logLevelsSpec,function(a,c){return b.makeMarker(c,{priority:a})});var g=[b.logLevel.IMPORTANT];b.model={},b.model.copyModel=function(c,d){b.clear(c),a.extend(!0,c,d)},b.model.parseEL=function(a){return""===a?[]:String(a).split(".")},b.model.composePath=function(a,b){return""===a?b:""===b?a:a+"."+b},b.model.composeSegments=function(){return b.makeArray(arguments).join(".")},b.lastDotIndex=function(a){return a.lastIndexOf(".")},b.model.getToTailPath=function(a){var c=b.lastDotIndex(a);return-1===c?"":a.substring(0,c)},b.model.getTailPath=function(a){var c=b.lastDotIndex(a);return a.substring(c+1)},b.path=b.model.composeSegments,b.composePath=b.model.composePath,b.requireDataBinding=function(){b.fail("Please include DataBinding.js in order to operate complex model accessor configuration")},b.model.setWithStrategy=b.model.getWithStrategy=b.requireDataBinding,b.model.resolvePathSegment=function(a,b,c,d){return!d&&a.resolvePathSegment?a.resolvePathSegment(b):c&&void 0===a[b]?a[b]={}:a[b]},b.model.parseToSegments=function(a,c,d){return"number"==typeof a||"string"==typeof a?c(a):d?b.makeArray(a):a},b.model.pathToSegments=function(a,c){var d=c&&c.parser?c.parser.parse:b.model.parseEL;return b.model.parseToSegments(a,d)},b.model.accessImpl=function(a,c,d,e,f,g,h){var i=b.model.pathToSegments(c,e),j=0;f&&(j=f.length,i=f.concat(i));var k=d===b.NO_VALUE?0:1;return a=h(a,i,j,e,k),d===b.NO_VALUE||d===b.VALUE?g?{root:a,segs:i}:a:void(a[i[i.length-1]]=d)},b.model.accessSimple=function(a,c,d,e,f,g){return b.model.accessImpl(a,c,d,e,f,g,b.model.traverseSimple)},b.model.traverseSimple=function(a,c,d,e,f){for(var g=e,h=c.length-f,i=0;h>i;++i){if(!a)return a;var j=c[i];a=e&&e[j]?e[j]:b.model.resolvePathSegment(a,j,1===f,g),e=null}return a},b.model.setSimple=function(a,c,d,e,f){b.model.accessSimple(a,c,d,e,f,!1)},b.model.getSimple=function(a,c,d,e){return null===c||void 0===c||0===c.length?a:b.model.accessSimple(a,c,b.NO_VALUE,d,e,!1)},b.getImmediate=function(a,b,c){for(var d=void 0===c?b.length:c+1,e=0;d>e;++e)a=a?a[b[e]]:void 0;return a},b.decodeAccessorArg=function(a){return a&&a!==b.model.defaultGetConfig&&a!==b.model.defaultSetConfig?"environment"===a.type?a.value:void 0:null},b.set=function(a,c,d,e,f){var g=b.decodeAccessorArg(e);void 0===g?b.model.setWithStrategy(a,c,d,e,f):b.model.setSimple(a,c,d,g,f)},b.get=function(a,c,d,e){var f=b.decodeAccessorArg(d);return void 0===f?b.model.getWithStrategy(a,c,d,e):b.model.accessImpl(a,c,b.NO_VALUE,f,null,!1,b.model.traverseSimple)},b.getGlobalValue=function(a,c){return a?(c=c||b.environment,b.get(b.global,a,{type:"environment",value:c})):void 0},b.bind=function(a,c,d){return a[c].apply(a,b.makeArray(d))},b.invokeGlobalFunction=function(a,c,d){var e=b.getGlobalValue(a,d);return e?e.apply(null,b.isArrayable(c)?c:b.makeArray(c)):void b.fail("Error invoking global function: "+a+" could not be located")},b.registerGlobalFunction=function(a,c,d){d=d||b.environment,b.set(b.global,a,c,{type:"environment",value:d})},b.setGlobalValue=b.registerGlobalFunction,b.registerNamespace=function(a,c){c=c||b.environment;var d=b.getGlobalValue(a,c);return d||(d={},b.setGlobalValue(a,d,c)),d},b.dumpEl=b.identity,b.renderTimestamp=b.identity,b.generateUniquePrefix=function(){return Math.floor(1e12*Math.random()).toString(36)+"-"};var h=b.generateUniquePrefix();b.fluidInstance=h;var i=1;b.allocateGuid=function(){return h+i++},b.registerNamespace("fluid.event"),b.extremePriority=4e9,b.priorityTypes={first:-1,last:1,before:0,after:0},b.extremalPriorities={none:0,testing:10,authoring:20},b.parsePriorityConstraint=function(a,c,d){var e=a.split(":"),f=e[0],g=b.priorityTypes[f];return void 0===g&&b.fail("Invalid constraint type in priority field "+a+": the only supported values are "+b.keys(b.priorityTypes).join(", ")+" or numeric"),c&&0===g&&b.fail("Constraint type in priority field "+a+" is not supported in a "+d+" record - you must use either a numeric value or first, last"),{type:e[0],target:e[1]}},b.parsePriority=function(a,c,d,e){a=a||0;var f={count:c||0,fixed:null,constraint:null,site:e};"number"==typeof a?f.fixed=-a:f.constraint=b.parsePriorityConstraint(a,d,e);var g=f.constraint?b.priorityTypes[f.constraint.type]:0;if(0!==g){var h=f.constraint.target||"none",i=b.extremalPriorities[h];void 0===i&&b.fail("Unrecognised extremal priority target "+h+": the currently supported values are "+b.keys(b.extremalPriorities).join(", ")+": register your value in fluid.extremalPriorities"),f.fixed=g*(b.extremePriority+i)}return null!==f.fixed&&(f.fixed+=f.count/1024),f},b.renderPriority=function(a){return a.constraint?a.constraint.target?a.constraint.type+":"+a.constraint.target:a.constraint.type:Math.floor(a.fixed)},b.compareByPriority=function(a,b){return null!==a.priority.fixed&&null!==b.priority.fixed?a.priority.fixed-b.priority.fixed:(null===a.priority.fixed)-(null===b.priority.fixed)},b.honourConstraint=function(a,c,d){var e=a[d].priority.constraint,f=b.find(a,function(a,b){return a.namespace===e.target?b:void 0},-1);if(-1===f)return!0;if(f>=c)return!1;for(var g="after"===e.type?1:0,h=f+g,i=a[d],j=d;j>=h;--j)a[j]=a[j-1];return a[h]=i,!0},b.sortByPriority=function(a){b.stableSort(a,b.compareByPriority);for(var c=b.find(a,function(a,c){return a.priority.constraint&&0===b.priorityTypes[a.priority.constraint.type]?c:void 0},a.length);;){if(c===a.length)return a;for(var d=c,e=c;e<a.length;++e){var f=b.honourConstraint(a,c,e);f&&++c}if(c===d){var g=a.slice(c);b.fail("Could not find targets for any constraints in "+g[0].priority.site+" ",g,": none of the targets ("+b.getMembers(g,"priority.constraint.target").join(", ")+") matched any namespaces of the elements in (",a.slice(0,c)+") - this is caused by either an invalid or circular reference")}}},b.parsePriorityRecords=function(c,d,e){var f=b.hashToArray(c,"namespace",function(c,f,g){e||a.extend(c,f),c.priority=b.parsePriority(e?f:f.priority,g,!1,d)});return b.sortByPriority(f),f},b.event.identifyListener=function(a,c){return"string"==typeof a||a.$$fluid_guid||c||(a.$$fluid_guid=b.allocateGuid()),a.$$fluid_guid},b.event.impersonateListener=function(a,c){b.event.identifyListener(a),c.$$fluid_guid=a.$$fluid_guid},b.event.sortListeners=function(a){var c=[];return b.each(a,function(a){for(var b,d=0;d<a.length;++d){var e=a[d];e.softNamespace||b||(b=e)}b?c.push(b):c=c.concat(a)}),b.sortByPriority(c)},b.event.resolveListener=function(a){var c=a.globalName||("string"==typeof a?a:null);if(c){var d=b.getGlobalValue(c);d?a=d:b.fail("Unable to look up name "+c+" as a global function")}return a},b.nameComponent=function(a){return a?"component with typename "+a.typeName+" and id "+a.id:"[unknown component]"},b.event.nameEvent=function(a,c){return c+" of "+b.nameComponent(a)},b.makeEventFirer=function(a){a=a||{};var c,d=a.name||"<anonymous>",e=function(){c.listeners={},c.byId={},c.sortedListeners=[],c.addListener=function(a,d,e,f,g){if(c.destroyed&&b.fail("Cannot add listener to destroyed event firer "+c.name),a){"string"==typeof a&&(a={globalName:a});var h=g||b.event.identifyListener(a);d=d||h;var i={listener:a,namespace:d,softNamespace:f,listenerId:g,priority:b.parsePriority(e,c.sortedListeners.length,!1,"listeners")};c.byId[h]=i;var j=c.listeners[d]=b.makeArray(c.listeners[d]);j[f?"push":"unshift"](i),c.sortedListeners=b.event.sortListeners(c.listeners)}},c.addListener.apply(null,arguments)};return c={eventId:b.allocateGuid(),name:d,ownerId:a.ownerId,typeName:"fluid.event.firer",destroy:function(){c.destroyed=!0},addListener:function(){e.apply(null,arguments)},removeListener:function(a){if(c.listeners){var d,e,f;"string"==typeof a?(d=a,f=c.listeners[d],f||(e=d,d=null)):"function"==typeof a&&(e=b.event.identifyListener(a,!0),e||b.fail("Cannot remove unregistered listener function ",a," from event "+c.name));var g=c.byId[e],h=g&&g.softNamespace;d=d||g&&g.namespace||e,delete c.byId[e],f=c.listeners[d],f&&(h?b.remove_if(f,function(a){return a.listener.$$fluid_guid===e||a.listenerId===e}):f.shift(),0===f.length&&delete c.listeners[d]),c.sortedListeners=b.event.sortListeners(c.listeners)}},fire:function(){var e=c.sortedListeners;if(e&&!c.destroyed){b.log(b.logLevel.TRACE,"Firing event "+d+" to list of "+e.length+" listeners");for(var f=0;f<e.length;++f){var g=e[f];g.listener=b.event.resolveListener(g.listener);var h,i=g.listener,j=i.apply(null,arguments);if((a.preventable&&j===!1||c.destroyed)&&(h=!1),void 0!==h)return h}}}}},b.event.addListenerToFirer=function(a,c,d,e){if(e=e||b.identity,b.isArrayable(c))for(var f=0;f<c.length;++f)b.event.addListenerToFirer(a,c[f],d,e);else"function"==typeof c||"string"==typeof c?e(a).addListener(c,d):c&&"object"==typeof c&&e(a).addListener(c.listener,d||c.namespace,c.priority,c.softNamespace,c.listenerId)},b.event.resolveListenerRecord=function(a){return{records:a}},b.expandImmediate=function(a){b.fail("fluid.expandImmediate could not be loaded - please include FluidIoC.js in order to operate IoC-driven event with descriptor "+a)},b.mergeListeners=function(a,c,d){b.each(d,function(d,e){var f,g;if("{"===e.charAt(0))f=b.expandImmediate(e,a),f||b.fail("Error in listener record: key "+e+' could not be looked up to an event firer - did you miss out "events." when referring to an event firer?');else{var h=e.indexOf(".");-1!==h&&(g=e.substring(h+1),e=e.substring(0,h)),c[e]||b.fail("Listener registered for event "+e+" which is not defined for this component"),f=c[e]}var i=b.event.resolveListenerRecord(d,a,e,g,!0);b.event.addListenerToFirer(f,i.records,g,i.adderWrapper)})},b.eventFromRecord=function(a,c,d){var e,f=a&&("string"!=typeof a||"{"===a.charAt(0));return f?b.event.resolveEvent?e=b.event.resolveEvent(d,c,a):b.fail("fluid.event.resolveEvent could not be loaded - please include FluidIoC.js in order to operate IoC-driven event with descriptor ",a):e=b.makeEventFirer({name:b.event.nameEvent(d,c),preventable:"preventable"===a,ownerId:d.id}),e},b.instantiateFirers=function(a,c){b.each(c.events,function(c,d){a.events[d]=b.eventFromRecord(c,d,a)})},b.mergeListenerPolicy=function(a,c,d){"string"!=typeof d&&b.fail("Error in listeners declaration - the keys in this structure must resolve to event names - got "+d+" from ",c);var e="{"!==d.charAt(0)&&-1!==d.indexOf(".");return e?c||a:b.arrayConcatPolicy(a,c)},b.makeMergeListenersPolicy=function(a,c){return function(d,e){return d=d||{},c&&(b.isArrayable(e)||"string"==typeof e.target)?d[""]=a(d[""],e,""):b.each(e,function(b,c){d[c]=a(d[c],b,c)}),d}},b.validateListenersImplemented=function(a){var c=[];return b.each(a.events,function(d,e){b.each(d.sortedListeners,function(d){(d.listener===b.notImplemented||"fluid.notImplemented"===d.listener.globalName)&&c.push({name:e,namespace:d.namespace,componentSource:b.model.getSimple(a.options.listeners,[e+"."+d.namespace,0,"componentSource"])})})}),c},b.unique=function(a){return b.remove_if(a,function(b,c){return!b||c>0&&b===a[c-1]})},b.arrayConcatPolicy=function(a,c){return b.makeArray(a).concat(b.makeArray(c))},b.failureEvent=b.makeEventFirer({name:"failure event"}),b.failureEvent.addListener(b.builtinFail,"fail"),b.failureEvent.addListener(b.logFailure,"log","before:fail"),b.pushSoftFailure=function(a){"function"==typeof a?b.failureEvent.addListener(a,"fail"):-1===a?b.failureEvent.removeListener("fail"):"boolean"==typeof a&&b.fail("pushSoftFailure with boolean value is no longer supported")},b.componentConstructor=function(){},b.typeTag=function(a){var c=Object.create(b.componentConstructor.prototype);return c.typeName=a,c.id=b.allocateGuid(),c};var j=1,k={};b.defaultsStore={};var l=function(a,c,d){var e=!0;d?e=1===c.length:c=b.makeArray(c);for(var f=c.length-1;f>=0;--f){var g=c[f];if(g&&!a.gradeHash[g]){var h="{"===g.charAt(0),i=(h?null:e?b.rawDefaults(g):b.getGradedDefaults(g))||{},m=k[g]||j-1;a.lastTick=Math.max(a.lastTick,m),a.gradeHash[g]=!0,a.gradeChain.push(g),a.optionsChain.push(i);for(var n=b.makeArray(i.gradeNames),o=n.length-1;o>=0;--o){var p=n[o];e?l(a,p):a.gradeHash[p]||(a.gradeHash[p]=!0,a.gradeChain.push(p))}}}return a};b.resolveGradeStructure=function(a,c){var d={lastTick:0,gradeChain:[],gradeHash:{},optionsChain:[]};return l(d,[a].concat(b.makeArray(c)),!0)};var m={};b.gradeNamesToKey=function(a,b){return a+"|"+b.join("|")},b.hasGrade=function(a,c){return a&&a.gradeNames?b.contains(a.gradeNames,c):!1},b.resolveGrade=function(c,d,e){for(var f=b.resolveGradeStructure(d,e),g=f.optionsChain.reverse(),h={},i=0;i<g.length;++i)g[i]&&g[i].mergePolicy&&(h=a.extend(!0,h,g[i].mergePolicy));g=[h,{}].concat(g);var j=b.merge.apply(null,g);return j.gradeNames=f.gradeChain.reverse(),{defaults:j,lastTick:f&&f.lastTick}},b.getGradedDefaults=function(a,c){c=b.makeArray(c);var d=b.gradeNamesToKey(a,c),e=m[d];if(e){for(var f=0,g=e.defaults.gradeNames||[],h=0;h<g.length;++h)f=Math.max(f,k[g[h]]||0);f>e.lastTick&&(b.log("Clearing cache for component "+a+" with gradeNames ",g),e=null)}if(!e){var i=b.rawDefaults(a);if(!i)return i;e=m[d]=b.resolveGrade(i,a,c)}return e.defaults},b.upgradePrimitiveFunc=function(a,c){if(a&&b.isPrimitive(a)){var d={};return d[c||("string"==typeof a&&"{"!==a.charAt(0)?"funcName":"func")]=a,d.args=b.NO_VALUE,d}return a},b.annotateListeners=function(a,c){c.listeners=b.transform(c.listeners,function(c){var d=b.makeArray(c);return b.transform(d,function(c){return c=b.upgradePrimitiveFunc(c,"listener"),c.componentSource=a,c})}),c.invokers=b.transform(c.invokers,function(c){return c=b.upgradePrimitiveFunc(c),c&&(c.componentSource=a),c})},b.rawDefaults=function(a,c){if(void 0===c){var d=b.defaultsStore[a];return d&&d.options}b.pushActivity("registerDefaults","registering defaults for grade %componentName with options %options",{componentName:a,options:c});var e=b.expandCompact?b.expandCompact(c):b.copy(c);b.annotateListeners(a,e);var f=b.getCallerInfo&&b.getCallerInfo(6);b.defaultsStore[a]={options:e,callerInfo:f},k[a]=j++,b.popActivity()},b.doIndexDefaults=function(a,c,d,e){for(var f=b.makeArray(e.gradeNames),g=0;g<f.length;++g)if(!b.hasGrade(c,f[g]))return;for(var h="function"==typeof e.indexFunc?e.indexFunc:b.getGlobalValue(e.indexFunc),i=h(c)||[],j=0;j<i.length;++j)b.pushArray(d,i[j],a)},b.indexDefaults=function(a,c){var d={};for(var e in b.defaultsStore){var f=b.getGradedDefaults(e);b.doIndexDefaults(e,f,d,c)}return d},b.defaults=function(a,c){if(void 0===c)return b.getGradedDefaults(a);c&&c.options&&b.fail("Probable error in options structure for "+a+' with option named "options" - perhaps you meant to write these options at top level in fluid.defaults? - ',c),b.rawDefaults(a,c);var d=b.getGradedDefaults(a);b.hasGrade(d,"fluid.function")||b.makeComponentCreator(a)},b.makeComponentCreator=function(c){var d=function(){var a=b.getGradedDefaults(c);if(a.gradeNames&&0!==a.gradeNames.length){if(a.initFunction)return b.initComponent(c,arguments);for(var d=[],e=0;e<a.gradeNames.length;++e){var f=a.gradeNames[e],g=b.rawDefaults(f);g||d.push(f)}0===d.length?b.fail("Cannot make component creator for type "+c+" which does not have an initFunction defined"):b.fail("The grade hierarchy of component with type "+c+" is incomplete - it inherits from the following grade(s): "+d.join(", ")+" for which the grade definitions are corrupt or missing. Please check the files which might include these grades and ensure they are readable and have been loaded by this instance of Infusion")}else b.fail("Cannot make component creator for type "+c+" which does not have any gradeNames defined")},e=b.getGlobalValue(c);e&&a.extend(d,e),b.setGlobalValue(c,d)};var n={};b.derefMergePolicy=function(a){return(a?a["*"]:n)||n},b.compileMergePolicy=function(a){var c={},d={},e={builtins:c,defaultValues:d};return a?(b.each(a,function(a,f){var g={},h=!0;if("function"==typeof a)g.func=a;else if("object"==typeof a)g=a;else if(b.isDefaultValueMergePolicy(a))b.set(d,f,"{that}.options."+a),e.hasDefaults=!0,h=!1;else for(var i=a.split(/\s*,\s*/),j=0;j<i.length;++j)g[i[j]]=!0;h&&b.set(c,b.composePath(f,"*"),g)}),e):e},b.isDefaultValueMergePolicy=function(a){return"string"==typeof a&&-1===a.indexOf(",")&&!/replace|nomerge|noexpand/.test(a)},b.mergeOneImpl=function(a,c,d,e,f,g,h){var i=a,j=b.isPrimitive(a);return void 0!==c&&(f.func||null===c||!b.isPlainObject(c)||f.nomerge?(e[d]=void 0,i=f.func?f.func.call(null,a,c,h[g-1],h,g):c):j&&(i=a=b.freshContainer(c))),i},b.fetchMergeChildren=function(a,c,d,e,f,g){for(var h=b.derefMergePolicy(f),i=e.length-1;i>=0;--i){var j=e[i];if(void 0!==j&&(b.each(j,function(h,i){i in a||(d[c]=i,b.getImmediate(g.exceptions,d,c)||g.strategy(a,i,c+1,d,e,f))}),h.replace))break}return a},b.inEvaluationMarker=Object.freeze({__CURRENTLY_IN_EVALUATION__:!0}),b.strategyRecursionBailout=50,b.makeMergeStrategy=function(a){var c=function(c,f,g,h,i,j){if(g>b.strategyRecursionBailout&&b.fail("Overflow/circularity in options merging, current path is ",h," at depth ",g,' - please protect components from merging using the "nomerge" merge policy'),b.isPrimitive(c))return void 0;b.isTracing&&b.tracing.pathCount.push(b.path(h.slice(0,g)));var k;if(f in c){if(k=c[f],!a.evaluateFully)return k}else c!==b.inEvaluationMarker&&(c[f]=b.inEvaluationMarker);void 0===i&&(h=b.makeArray(h),i=e(a.sources,h,g-1,a.sourceStrategies),j=d(a.mergePolicy,h,g-1,b.concreteTrundler));var l,m,n,o=b.concreteTrundler(j,f),p=b.derefMergePolicy(o);p.replace?(l=1-i.length,m=0,n=-1):(l=0,m=i.length-1,n=1);for(var q,r=[],s=l;m>=s;++s){var t=n*s,u=a.sourceStrategies[t](i[t],f,g,h);if(void 0!==u&&(r[t]=u,void 0===k)){if(-1===n){q=c[f]=u;break}q=b.mergeOneImpl(q,u,s,r,p,g,h,a),c!==b.inEvaluationMarker&&(c[f]=q)}}return void 0!==k&&(q=k),r.length>0&&b.isPlainObject(q)&&b.fetchMergeChildren(q,g,h,r,o,a),void 0===k&&0===r.length&&delete c[f],q};return a.strategy=c,c},b.driveStrategy=function(a,c,d){c=b.makeArray(c);for(var e=0;e<c.length;++e){if(!a)return void 0;a=d(a,c[e],e+1,c)}return a},b.concreteTrundler=function(a,b){return a?a[b]:void 0},b.merge=function(a){var c=Array.prototype.slice.call(arguments,1),d=b.compileMergePolicy(a).builtins,e=b.makeMergeOptions(d,c,{});return e.initter(),e.target},b.simpleGingerBlock=function(a,c){var d={target:a,simple:!0,strategy:b.concreteTrundler,initter:b.identity,recordType:c,priority:b.mergeRecordTypes[c]};return d},b.makeMergeOptions=function(c,d,e){var f={mergePolicy:c,sources:d};return f=a.extend(f,e),f.target=f.target||b.freshContainer(f.sources[0]),f.sourceStrategies=f.sourceStrategies||b.generate(f.sources.length,b.concreteTrundler),f.initter=function(){f.evaluateFully=!0,b.fetchMergeChildren(f.target,0,[],f.sources,f.mergePolicy,f)},b.makeMergeStrategy(f),f},b.transformOptions=function(a,c){b.expect("Options transformation record",c,["transformer","config"]);var d=b.getGlobalValue(c.transformer);return d.call(null,a,c.config)},b.findMergeBlocks=function(a,c){return b.remove_if(b.makeArray(a),function(a){return a.recordType!==c})},b.transformOptionsBlocks=function(a,c,d){b.each(d,function(d){var e=b.findMergeBlocks(a,d);b.each(e,function(a){var d=a.source?"source":"target";a[a.simple||"target"===d?"target":"source"]=b.transformOptions(a[d],c)})})},b.dedupeDistributionNamespaces=function(a){var c={};b.remove_if(a,function(a){var b=a.namespace;if(b){if(c[b]&&c[b]!==a.contextThat.id)return!0;c[b]=a.contextThat.id}})},b.deliverOptionsStrategy=b.identity,b.computeComponentAccessor=b.identity,b.computeDynamicComponents=b.identity,b.mergeRecordTypes={defaults:1e3,defaultValueMerge:900,subcomponentRecord:800,user:700,distribution:100},b.model.applyChangeRequest=function(c,d){var e=d.segs;if(0===e.length)"ADD"===d.type?a.extend(!0,c,d.value):b.clear(c);else if("ADD"===d.type)b.model.setSimple(c,d.segs,d.value);else{for(var f=0;f<e.length-1;++f)if(c=c[e[f]],!c)return;var g=e[e.length-1];delete c[g]}},b.destroyValue=function(a,c){a&&b.model.applyChangeRequest(a,{type:"DELETE",segs:c})},b.mergeComponentOptions=function(c,d,e,f){function g(){s=b.driveStrategy(l,"mergePolicy",q.strategy),s=a.extend({},b.rootMergePolicy,s),r=b.compileMergePolicy(s),a.extend(!0,j,r.builtins)}var h=b.rawDefaults(d),i=b.getGradedDefaults(d,h&&h.gradeNames?null:f.gradeNames),j={},k=[];k=b.expandComponentOptions?k.concat(b.expandComponentOptions(j,i,e,c)):k.concat([b.simpleGingerBlock(i,"defaults"),b.simpleGingerBlock(e,"user")]);var l={},m=[],n=[],o={target:l,sourceStrategies:m},p=function(){b.each(k,function(a){b.isPrimitive(a.priority)&&(a.priority=b.parsePriority(a.priority,0,!1,"options distribution"))}),b.sortByPriority(k),b.dedupeDistributionNamespaces(k),m.length=0,n.length=0,b.each(k,function(a){m.push(a.strategy),n.push(a.target)})};p();var q=b.makeMergeOptions(j,n,o);q.mergeBlocks=k,q.updateBlocks=p,q.destroyValue=function(a){for(var c=0;c<k.length;++c)b.destroyValue(k[c].target,a);b.destroyValue(o.target,a)};var r,s;g(),q.computeMergePolicy=g,r.hasDefaults&&(b.generateExpandBlock?(k.push(b.generateExpandBlock({options:r.defaultValues,recordType:"defaultValueMerge",priority:b.mergeRecordTypes.defaultValueMerge},c,{})),p()):b.fail("Cannot operate mergePolicy ",s," for component ",c," without including FluidIoC.js")),c.options=l,b.driveStrategy(l,"gradeNames",q.strategy),b.deliverOptionsStrategy(c,l,q),b.computeComponentAccessor(c,e&&e.localRecord);var t=b.driveStrategy(l,"transformOptions",q.strategy);return t&&(b.transformOptionsBlocks(k,t,["user","subcomponentRecord"]),p()),o.target.mergePolicy||g(),q},b.defaults("fluid.function",{}),b.invokeGradedFunction=function(a,c){var d=b.defaults(a);d&&d.argumentMap&&b.hasGrade(d,"fluid.function")||b.fail("Cannot look up name "+a+" to a function with registered argumentMap - got defaults ",d);var e=[];return b.each(d.argumentMap,function(a,b){e[a]=c[b]}),b.invokeGlobalFunction(a,e)},b.noNamespaceDistributionPrefix="no-namespace-distribution-",b.mergeOneDistribution=function(c,d,e){var f=d.namespace||e||b.noNamespaceDistributionPrefix+b.allocateGuid();d.namespace=f,c[f]=a.extend(!0,{},c[f],d)},b.distributeOptionsPolicy=function(a,c){if(a=a||{},b.isArrayable(c))for(var d=0;d<c.length;++d)b.mergeOneDistribution(a,c[d]);else"string"==typeof c.target?b.mergeOneDistribution(a,c):b.each(c,function(c,d){b.mergeOneDistribution(a,c,d)});return a},b.mergingArray=function(){},b.mergingArray.prototype=[],b.membersMergePolicy=function(a,c){return a=a||{},b.each(c,function(c,d){a[d]||(a[d]=new b.mergingArray),c instanceof b.mergingArray?a[d].push.apply(a[d],c):void 0!==c&&a[d].push(c)}),a},b.invokerStrategies=b.arrayToHash(["func","funcName","listener","this","method"]),
b.invokersMergePolicy=function(c,d){return c=c||{},b.each(d,function(d,e){if(!d)return void(c[e]=d);d=b.upgradePrimitiveFunc(d);var f=c[e];f||(f=c[e]={});for(var g in b.invokerStrategies)if(g in d)for(var h in b.invokerStrategies)f[h]=void 0;a.extend(f,d)}),c},b.rootMergePolicy={gradeNames:b.arrayConcatPolicy,distributeOptions:b.distributeOptionsPolicy,members:{noexpand:!0,func:b.membersMergePolicy},invokers:{noexpand:!0,func:b.invokersMergePolicy},transformOptions:"replace",listeners:b.makeMergeListenersPolicy(b.mergeListenerPolicy)},b.defaults("fluid.component",{initFunction:"fluid.initLittleComponent",mergePolicy:b.rootMergePolicy,argumentMap:{options:0},events:{onCreate:null,onDestroy:null,afterDestroy:null}}),b.defaults("fluid.emptySubcomponent",{gradeNames:["fluid.component"]}),b.computeNickName=function(a){var c=b.model.parseEL(a);return c[c.length-1]},b.defaults("fluid.typeFount",{gradeNames:["fluid.component"]}),b.initLittleComponent=function(a,c,d,e){var f=b.typeTag(a);f.lifecycleStatus="constructing",d=d||{gradeNames:"fluid.component"},f.destroy=b.makeRootDestroy(f);var g=b.mergeComponentOptions(f,a,c,d);g.exceptions={members:{model:!0,modelRelay:!0}};var h=f.options;f.events={},(e||b.identity)(f,h,g.strategy),b.computeDynamicComponents(f,g);for(var i=0;i<g.mergeBlocks.length;++i)g.mergeBlocks[i].initter();return g.initter(),delete h.mergePolicy,b.instantiateFirers(f,h),b.mergeListeners(f,f.events,h.listeners),f},b.diagnoseFailedView=b.identity,b.makeRootDestroy=function(a){return function(){b.doDestroy(a),a.events.afterDestroy.fire(a,"",null)}},b.isDestroyed=function(a){return"destroyed"===a.lifecycleStatus},b.doDestroy=function(a,b,c){a.events.onDestroy.fire(a,b||"",c),a.lifecycleStatus="destroyed";for(var d in a.events)"afterDestroy"!==d&&"function"==typeof a.events[d].destroy&&a.events[d].destroy();a.applier&&a.applier.destroy()},b.initComponent=function(a,c){var d=b.defaults(a);d.gradeNames||b.fail("Cannot initialise component "+a+" which has no gradeName registered");var e,f=[a].concat(b.makeArray(c));b.pushActivity("initComponent","constructing component of type %componentName with arguments %initArgs",{componentName:a,initArgs:c}),e=b.invokeGlobalFunction(d.initFunction,f),b.diagnoseFailedView(a,e,d,f),b.initDependents&&b.initDependents(e);var g=b.validateListenersImplemented(e);return g.length>0&&b.fail(b.transform(g,function(a){return" - the listener for event "+a.name+" with namespace "+a.namespace+((a.componentSource?" which was defined in grade "+a.componentSource:"")+" needs to be overridden with a concrete implementation")})).join("\n"),"constructing"===e.lifecycleStatus&&(e.lifecycleStatus="constructed"),e.events.onCreate.fire(e),b.popActivity(),e},b.initSubcomponentImpl=function(a,c,d){var e;if("function"!=typeof c){var f="string"==typeof c?c:c.type;e="fluid.emptySubcomponent"===f?null:b.invokeGlobalFunction(f,d)}else e=c.apply(null,d);return e};var o="(?:[\\w\\u00c0-\\uFFFF*_-";b.simpleCSSMatcher={regexp:new RegExp("([#.]?)("+o+"]|\\\\.)+)","g"),charToTag:{"":"tag","#":"id",".":"clazz"}},b.IoCSSMatcher={regexp:new RegExp("([&#]?)("+o+"]|\\.|\\/)+)","g"),charToTag:{"":"context","&":"context","#":"id"}};var p=new RegExp("\\s*(>)?\\s*","g");b.parseSelector=function(a,c){var d=[];a=a.trim();var e=c.regexp;e.lastIndex=0;for(var f=0;;){for(var g=[],h=!0;;){var i=e.exec(a);if(!i)break;if(i.index!==f){if(!h)break;b.fail("Error in selector string - cannot match child selector expression starting at "+a.substring(f))}var j={},k=i[2],l=c.charToTag[i[1]];l&&(j[l]=k),g[g.length]=j,f=e.lastIndex,h=!1}p.lastIndex=f;var m={predList:g},n=p.exec(a);if(n&&n.index===f||b.fail("Error in selector string - can not match child selector expression at "+a.substring(f)),">"===n[1]&&(m.child=!0),d[d.length]=m,p.lastIndex>=a.length)break;f=p.lastIndex,e.lastIndex=p.lastIndex}return d},b.stringToRegExp=function(a,b){return new RegExp(a.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&"),b)},b.stringTemplate=function(a,c){var d=b.keys(c);d=d.sort(b.compareStringLength());for(var e=0;e<d.length;++e){var f=d[e],g=b.stringToRegExp("%"+f,"g");a=a.replace(g,c[f])}return a}}(jQuery,fluid_2_0_0);var fluid_2_0_0=fluid_2_0_0||{},fluid=fluid||fluid_2_0_0;!function(a,b){"use strict";function c(a,d,e){function f(a){e.output+=a}var g=d+e.indentChars,h="function"==typeof a;if(void 0!==e.maxRenderChars&&e.output.length>e.maxRenderChars)return!0;if(null===a)f("null");else if(void 0===a)f("undefined");else if(a===b.SYNTHETIC_PROPERTY)f("[Synthetic property]");else if(b.isPrimitive(a)&&!h)f(JSON.stringify(a));else{if(-1!==e.stack.indexOf(a))return void f("(CIRCULAR)");e.stack.push(a);var i;if(b.isArrayable(a))if(0===a.length)f("[]");else{for(f("[\n"+g),i=0;i<a.length;++i){if(c(a[i],g,e))return!0;i!==a.length-1&&f(",\n"+g)}f("\n"+d+"]")}else{f("{"+(h?" Function":"")+"\n"+g);var j=b.keys(a);for(i=0;i<j.length;++i){var k=j[i],l=b.getSafeProperty(a,k);if(f(JSON.stringify(k)+": "),c(l,g,e))return!0;i!==j.length-1&&f(",\n"+g)}f("\n"+d+"}")}e.stack.pop()}}b.renderTimestamp=function(a){var b=function(a,b){b||(b=2);var c=void 0===a?"":a.toString();return"00000".substring(5-b+c.length)+c};return b(a.getHours())+":"+b(a.getMinutes())+":"+b(a.getSeconds())+"."+b(a.getMilliseconds(),3)},b.isTracing=!1,b.registerNamespace("fluid.tracing"),b.tracing.pathCount=[],b.tracing.summarisePathCount=function(a){a=a||b.tracing.pathCount;for(var c={},d=0;d<a.length;++d){var e=a[d];c[e]?++c[e]:c[e]=1}var f=[];return b.each(c,function(a,b){f.push({path:b,count:a})}),f.sort(function(a,b){return b.count-a.count}),f},b.tracing.condensePathCount=function(a,c){a=b.makeArray(a);var d={};b.each(a,function(a){d[a]=0});var e=[];return b.each(c,function(c){var f=c.path;b.find(a,function(a){return 0===f.indexOf(a)?(d[a]+=c.count,!0):void 0})||e.push(c)}),b.each(d,function(a,b){e.unshift({path:b,count:a})}),e},b.detectStackStyle=function(a){var b="other",c={offset:0};return a.arguments?b="chrome":"undefined"!=typeof window&&window.opera&&a.stacktrace?b="opera10":a.stack?(b="firefox",c.offset=-1===a.stack.indexOf("Trace exception")?1:0):"undefined"==typeof window||!window.opera||"stacktrace"in a||(b="opera"),c.style=b,c},b.obtainException=function(){try{throw new Error("Trace exception")}catch(a){return a}};var d=b.detectStackStyle(b.obtainException());b.registerNamespace("fluid.exceptionDecoders"),b.decodeStack=function(){if("firefox"!==d.style)return null;var a=b.obtainException();return b.exceptionDecoders[d.style](a)},b.exceptionDecoders.firefox=function(a){var c="at ",d=a.stack.replace(/(?:\n@:0)?\s+$/m,"").replace(/^\(/gm,"{anonymous}(").split("\n");return b.transform(d,function(a){a=a.replace(/\)/g,"");var b=a.indexOf(c);return-1===b?[a]:[a.substring(b+c.length),a.substring(0,b)]})},b.getCallerInfo=function(a){a=(a||3)-d.offset;var c=b.decodeStack(),e=c&&c[a][0];if(e){var f=e.lastIndexOf("/");-1===f&&(f=0);var g=e.indexOf(":",f);return{path:e.substring(0,f),filename:e.substring(f+1,g),index:e.substring(g+1)}}return null},b.generatePadding=function(a,b){for(var c="",d=0;b>d;++d)c+=a;return c},b.SYNTHETIC_PROPERTY={},b.getSafeProperty=function(a,c){var d=Object.getOwnPropertyDescriptor(a,c);return d&&!d.get?a[c]:b.SYNTHETIC_PROPERTY},b.prettyPrintJSON=function(d,e){return e=a.extend({indent:4,stack:[],output:""},e),e.indentChars=b.generatePadding(" ",e.indent),c(d,"",e),e.output},b.dumpEl=function(c){var d;if(!c)return"null";if(3===c.nodeType||8===c.nodeType)return"[data: "+c.data+"]";if(9===c.nodeType)return"[document: location "+c.location+"]";if(!c.nodeType&&b.isArrayable(c)){d="[";for(var e=0;e<c.length;++e)d+=b.dumpEl(c[e]),e<c.length-1&&(d+=", ");return d+"]"}return c=a(c),d=c.get(0).tagName,c.id&&(d+="#"+c.id),c.attr("class")&&(d+="."+c.attr("class")),d}}(jQuery,fluid_2_0_0);var fluid_2_0_0=fluid_2_0_0||{};!function(a,b){"use strict";function c(a,c,d,e){for(var f=0;d>f;++f)a=e(a,c[f],f,b.makeArray(c));return a}b.visitComponentChildren=function(a,c,d,e){e=e||[];for(var f in a){var g=a[f];if(!(!b.isComponent(g)||d.visited&&d.visited[g.id])){if(e.push(f),d.visited&&(d.visited[g.id]=!0),c(g,f,e,e.length-1))return!0;d.flat||b.visitComponentChildren(g,c,d,e),e.pop()}}},b.getContextHash=function(a,b){var c=a.idToShadow[b.id];return c&&c.contextHash},b.componentHasGrade=function(a,c){var d=b.getContextHash(b.globalInstantiator,a);return!(!d||!d[c])},b.visitComponentsForMatching=function(c,d,e){var f=b.getInstantiator(c);d=a.extend({visited:{},instantiator:f},d);var g=[c],h=[b.getContextHash(f,c)],i=function(a,c,d){g.length=1,h.length=1;for(var i=0;i<d.length;++i){var j=g[i][d[i]];g[i+1]=j,h[i+1]=b.getContextHash(f,j)||{}}return e(a,g,h,d,d.length)};b.visitComponentChildren(c,i,d,[])},b.getMemberNames=function(a,c){var d=a.idToPath(c[c.length-1].id),e=a.parseEL(d);return e.unshift.apply(e,b.generate(c.length-e.length,"")),e},b.visitComponentsForVisibility=function(a,c,d,e){e=e||{visited:{},flat:!0,instantiator:a};for(var f=b.getMemberNames(a,c),g=c.length-1;g>=0;--g){var h=c[g];if(e.visited[h.id]=!0,d(h,f[g],f,g))return;if(b.visitComponentChildren(h,d,e,f))return;f.pop()}},b.mountStrategy=function(a,b,c){var d=a.length;return function(b,e,f,g){if(!(f<=a.length)){for(var h=0;h<a.length;++h)if(g[h]!==a[h])return;return c(b,e,f-a.length,g.slice(d))}}},b.invokerFromRecord=function(a,c,d){b.pushActivity("makeInvoker","beginning instantiation of invoker with name %name and record %record as child of %that",{name:c,record:a,that:d});var e=a?b.makeInvoker(d,a,c):void 0;return b.popActivity(),e},b.memberFromRecord=function(c,d,e){for(var f,g=0;g<c.length;++g){var h=b.expandImmediate(c[g],e);f=b.isPlainObject(f)?a.extend(!0,f,h):h}return f},b.recordStrategy=function(a,c,d,e,f,g,h){return g=g||[],{strategy:function(g,h,i){if(1===i){var j=b.driveStrategy(c,[e,h],d);if(void 0!==j){b.set(g,[h],b.inEvaluationMarker);var k=f(j,h,a);return b.set(g,[h],k),k}}},initter:function(){var f=b.driveStrategy(c,e,d)||{};for(var i in f)h&&h[i]||b.getForComponent(a,g.concat([i]))}}},b.instantiateFirers=function(a){var c=b.shadowForComponent(a),d=b.get(c,["eventStrategyBlock","initter"])||b.identity;d()},b.makeDistributionRecord=function(c,d,e,f,g,h){h=h||"distribution",b.pushActivity("makeDistributionRecord","Making distribution record from source record %sourceRecord path %sourcePath to target path %targetSegs",{sourceRecord:d,sourcePath:e,targetSegs:f});var i=b.copy(b.get(d,e));b.each(g,function(a){b.model.applyChangeRequest(i,{segs:a,type:"DELETE"})});var j={options:{}};return b.model.applyChangeRequest(j,{segs:f,type:"ADD",value:i}),b.checkComponentRecord(j),b.popActivity(),a.extend(j,{contextThat:c,recordType:h})},b.filterBlocks=function(c,d,e,f,g,h){var i=[];return b.each(d,function(d){var j=b.get(d.source,e);if(j){i.push(b.makeDistributionRecord(c,d.source,e,f,g,d.recordType));var k=a.extend({},j);h&&b.model.applyChangeRequest(d.source,{segs:e,type:"DELETE"}),b.each(g,function(a){var c=b.get(k,a);b.set(d.source,e.concat(a),c)})}}),i},b.noteCollectedDistribution=function(a,c,d){b.model.setSimple(a,["collectedDistributions",c,d.id],!0)},b.isCollectedDistribution=function(a,c,d){return b.model.getSimple(a,["collectedDistributions",c,d.id])},b.clearCollectedDistributions=function(a,c){b.model.applyChangeRequest(a,{segs:["collectedDistributions",c],type:"DELETE"})},b.collectDistributions=function(a,c,d,e,f,g,h){var i=g[g.length-1];!b.isCollectedDistribution(c,i,d)&&b.matchIoCSelector(d.selector,e,f,g,h)&&(a.push.apply(a,d.blocks),b.noteCollectedDistribution(c,i,d))},b.registerCollectedClearer=function(a,c,d){!a.collectedClearer&&c&&(a.collectedClearer=function(){b.clearCollectedDistributions(c,d)})},b.receiveDistributions=function(a,c,d,e){var f=b.getInstantiator(a||e),g=f.getThatStack(a||e);g.unshift(b.rootComponent);var h=b.getMemberNames(f,g),i=b.transform(g,function(a){return f.idToShadow[a.id]}),j=i[i.length-(a?1:2)],k=b.getMembers(i,"contextHash");a?(h.push(d),k.push(b.gradeNamesToHash(c)),g.push(e)):b.registerCollectedClearer(i[i.length-1],j,h[h.length-1]);for(var l=[],m=0;m<g.length-1;++m)b.each(i[m].distributions,function(a){b.collectDistributions(l,j,a,g,k,h,m)});return l},b.computeTreeDistance=function(a,b){for(var c=0;c<a.length&&c<b.length&&a[c]===b[c];)++c;return a.length+b.length-2*c},b.computeDistributionPriority=function(a,c){if(!c.priority){var d=b.getInstantiator(a),e=d.getThatStack(a),f=b.getMemberNames(d,e),g=d.getThatStack(c.contextThat),h=b.getMemberNames(d,g),i=b.computeTreeDistance(f,h);c.priority=b.mergeRecordTypes.distribution-i}return c},b.applyDistributions=function(a,c,d){var e=b.transform(c,function(c){return b.generateExpandBlock(c,a,d.mergePolicy)},function(c){return b.computeDistributionPriority(a,c)}),f=d.mergeOptions;return f.mergeBlocks.push.apply(f.mergeBlocks,e),f.updateBlocks(),e},b.matchIoCSelector=function(a,b,c,d,e){for(var f=b.length-1,g=a.length-1;;){for(var h=f===b.length-1||a[g].child,i=b[f],j=a[g],k=!0,l=0;l<j.predList.length;++l){var m=j.predList[l];if(m.context&&!c[f][m.context]&&d[f]!==m.context){k=!1;break}if(m.id&&i.id!==m.id){k=!1;break}}if(0===g&&f>e&&h&&(k=!1),k){if(0===g)return!0;--f,--g}else{if(h)return!1;--f}if(e>f)return!1}},b.queryIoCSelector=function(a,c,d){var e=b.parseSelector(c,b.IoCSSMatcher),f=[];return b.visitComponentsForMatching(a,{flat:d},function(a,c,d,g,h){b.matchIoCSelector(e,c,d,g,h)&&f.push(a)}),f},b.isIoCSSSelector=function(a){return-1!==a.indexOf(" ")},b.pushDistributions=function(a,c,d,e){var f=b.shadowForComponent(a),g=b.allocateGuid(),h={id:g,target:d,selector:c,blocks:e};return Object.freeze(h),Object.freeze(h.blocks),b.pushArray(f,"distributions",h),g},b.clearDistribution=function(a,c){var d=b.shadowForComponent(a);b.remove_if(d.distributions,function(a){return a.id===c})},b.clearDistributions=function(a){b.each(a.outDistributions,function(a){b.clearDistribution(a.targetComponent,a.distributionId)})},b.extractSelectorHead=function(a){var b=a[0].predList,c=b[0].context;return b.length=0,c},b.parseExpectedOptionsPath=function(a,c){var d=b.model.parseEL(a);return"options"!==d[0]&&b.fail("Error in options distribution path ",a," - only "+c+' paths beginning with "options" are supported'),d.slice(1)},b.replicateProperty=function(a,c,d){void 0!==a[c]&&b.each(d,function(b){b[c]=a[c]})},b.undistributableOptions=["gradeNames","distributeOptions","argumentMap","initFunction","mergePolicy","progressiveCheckerOptions"],b.distributeOptions=function(a,c){var d=b.shadowForComponent(a),e=b.driveStrategy(a.options,"distributeOptions",c);b.each(e,function(c){b.pushActivity("distributeOptions","parsing distributeOptions block %record %that ",{that:a,record:c}),"string"!=typeof c.target&&b.fail("Error in options distribution record ",c,' a member named "target" must be supplied holding an IoC reference'),"string"==typeof c.source^void 0===c.record&&b.fail("Error in options distribution record ",c,': must supply either a member "source" holding an IoC reference or a member "record" holding a literal record');var e,f,g,h=b.parseContextReference(c.target);if(b.isIoCSSSelector(h.context)){f=b.parseSelector(h.context,b.IoCSSMatcher);var i=b.extractSelectorHead(f);"/"===i?e=b.rootComponent:g=i}else g=h.context;e=e||b.resolveContext(g,a),e||b.fail("Error in options distribution record ",c," - could not resolve context {"+g+"} to a root component");var j,k=b.model.parseEL(h.path);if(void 0!==c.record)j=[b.makeDistributionRecord(a,c.record,[],k,[])];else{var l=b.parseContextReference(c.source);"that"!==l.context&&b.fail("Error in options distribution record ",c," only a context of {that} is supported");var m=b.parseExpectedOptionsPath(l.path,"source"),n=b.makeArray(c.exclusions).concat(0===m.length?b.undistributableOptions:[]),o=b.transform(n,function(a){return b.model.parseEL(a)});j=b.filterBlocks(a,d.mergeOptions.mergeBlocks,m,k,o,c.removeSource),d.mergeOptions.updateBlocks()}if(b.replicateProperty(c,"priority",j),b.replicateProperty(c,"namespace",j),f){var p=b.pushDistributions(e,f,c.target,j);d.outDistributions=d.outDistributions||[],d.outDistributions.push({targetComponent:e,distributionId:p})}else{var q=b.shadowForComponent(e);b.applyDistributions(a,j,q)}b.popActivity()})},b.gradeNamesToHash=function(a){var c={};return b.each(a,function(a){c[a]=!0,c[b.computeNickName(a)]=!0}),c},b.cacheShadowGrades=function(a,c){var d=b.gradeNamesToHash(a.options.gradeNames);d[c.memberName]||(d[c.memberName]="memberName"),c.contextHash=d,b.each(d,function(b,d){c.ownScope[d]=a,c.parentShadow&&"fluid.rootComponent"!==c.parentShadow.that.type&&(c.parentShadow.childrenScope[d]=a)})},b.deliverOptionsStrategy=function(a,c,d){var e=b.shadowForComponent(a,e);b.cacheShadowGrades(a,e),e.mergeOptions=d},b.collectDistributedGrades=function(a){var c=b.receiveDistributions(null,null,null,a.that);if(c.length>0){var d=b.applyDistributions(a.that,c,a.shadow),e=b.transform(b.getMembers(d,["source","gradeNames"]),b.makeArray);b.accumulateDynamicGrades(a,b.flatten(e))}},b.applyDynamicGrades=function(a){a.oldGradeNames=b.makeArray(a.gradeNames);var c=b.copy(b.getGradedDefaults(a.that.typeName,a.gradeNames));a.gradeNames.length=0,a.gradeNames.push.apply(a.gradeNames,c.gradeNames),b.each(a.gradeNames,function(b){"{"!==b.charAt(0)&&(a.seenGrades[b]=!0)});var d=a.shadow;b.cacheShadowGrades(a.that,d),d.mergeOptions.destroyValue(["mergePolicy"]),d.mergeOptions.destroyValue(["components"]),d.mergeOptions.destroyValue(["invokers"]),a.defaultsBlock.source=c,d.mergeOptions.updateBlocks(),d.mergeOptions.computeMergePolicy(),b.accumulateDynamicGrades(a,c.gradeNames)},b.accumulateDynamicGrades=function(a,c){b.each(c,function(c){a.seenGrades[c]||("{"===c.charAt(0)?(a.rawDynamic.push(c),a.seenGrades[c]=!0):b.contains(a.oldGradeNames,c)||a.plainDynamic.push(c))})},b.computeDynamicGrades=function(a,c,d){delete a.options.gradeNames;var e=b.driveStrategy(a.options,"gradeNames",d);e.length=0;var f=b.findMergeBlocks(c.mergeOptions.mergeBlocks,"defaults")[0],g={that:a,shadow:c,defaultsBlock:f,gradeNames:e,seenGrades:{},plainDynamic:[],rawDynamic:[]};for(b.each(c.mergeOptions.mergeBlocks,function(a){e.push.apply(e,b.makeArray(a.source&&a.source.gradeNames)),b.applyDynamicGrades(g)}),b.collectDistributedGrades(g);;){for(;g.plainDynamic.length>0;)e.push.apply(e,g.plainDynamic),g.plainDynamic.length=0,b.applyDynamicGrades(g),b.collectDistributedGrades(g);if(!(g.rawDynamic.length>0))break;var h=b.expandImmediate(g.rawDynamic.shift(),a,c.localDynamic);"function"==typeof h&&(h=h()),h&&(g.plainDynamic=g.plainDynamic.concat(h))}c.collectedClearer&&(c.collectedClearer(),delete c.collectedClearer)},b.computeDynamicComponentKey=function(a,b){return a+(0===b?"":"-"+b)},b.registerDynamicRecord=function(a,c,d,e,f){var g=b.computeDynamicComponentKey(c,d),h=b.copy(e);return delete h[f],b.set(a.options,["components",g],h),g},b.computeDynamicComponents=function(a,c){var d=b.shadowForComponent(a),e=d.subcomponentLocal={},f=b.driveStrategy(a.options,"dynamicComponents",c.strategy);b.each(f,function(c,f){if(c.sources||c.createOnEvent||b.fail("Cannot process dynamicComponents record ",c,' without a "sources" or "createOnEvent" entry'),c.sources){var g=b.expandOptions(c.sources,a);b.each(g,function(d,g){var h=b.registerDynamicRecord(a,f,g,c,"sources");e[h]={source:d,sourcePath:g}})}else if(c.createOnEvent){var h=b.event.expandOneEvent(a,c.createOnEvent);b.set(d,["dynamicComponentCount",f],0);var i=function(){var e=b.registerDynamicRecord(a,f,d.dynamicComponentCount[f]++,c,"createOnEvent"),g={arguments:b.makeArray(arguments)};b.initDependent(a,e,g)};h.addListener(i),b.recordListener(h,i,d)}})},b.computeComponentAccessor=function(a,c){var d=b.globalInstantiator,e=b.shadowForComponent(a);e.localDynamic=c;var f=a.options,g=e.mergeOptions.strategy,h=b.mountStrategy(["options"],f,g);e.invokerStrategy=b.recordStrategy(a,f,g,"invokers",b.invokerFromRecord),e.eventStrategyBlock=b.recordStrategy(a,f,g,"events",b.eventFromRecord,["events"]);var i=b.mountStrategy(["events"],a,e.eventStrategyBlock.strategy,["events"]);if(e.memberStrategy=b.recordStrategy(a,f,g,"members",b.memberFromRecord,null,{model:!0,modelRelay:!0}),e.getConfig={strategies:[b.model.funcResolverStrategy,b.makeGingerStrategy(a),h,e.invokerStrategy.strategy,e.memberStrategy.strategy,i]},b.computeDynamicGrades(a,e,g,e.mergeOptions.mergeBlocks),b.distributeOptions(a,g),e.contextHash["fluid.resolveRoot"]){var j;if(e.contextHash["fluid.resolveRootSingle"]){var k=b.getForComponent(a,["options","singleRootType"]);k||b.fail("Cannot register object with grades "+Object.keys(e.contextHash).join(", ")+" as fluid.resolveRootSingle since it has not defined option singleRootType"),j=b.typeNameToMemberName(k)}else j=b.computeGlobalMemberName(a);var l=b.resolveRootComponent;l[j]&&d.clearComponent(l,j),d.recordKnownComponent(l,a,j,!1)}return e.getConfig},b.shadowForComponent=function(a){var c=b.getInstantiator(a);return c&&a?c.idToShadow[a.id]:null},b.getForComponent=function(a,c){var d=b.shadowForComponent(a),e=d?d.getConfig:void 0;return b.get(a,c,e)},b.makeGingerStrategy=function(a){var c=b.getInstantiator(a);return function(a,d,e,f){var g=a[d];if(g===b.inEvaluationMarker&&e===f.length&&b.fail('Error in component configuration - a circular reference was found during evaluation of path segment "'+d+'": for more details, see the activity records following this message in the console, or issue fluid.setLogging(fluid.logLevel.TRACE) when running your application'),e>1)return g;if(void 0===g&&a.hasOwnProperty(d))return b.NO_VALUE;if(void 0===g){var h=c.idToShadow[a.id].path,i=c.composePath(h,d);g=c.pathToComponent[i]}if(void 0===g){var j=b.getForComponent(a,["options","components",d]);j&&(j.createOnEvent&&b.fail('Error resolving path segment "'+d+'" of path '+f.join(".")+" since component with record ",j,' has annotation "createOnEvent" - this very likely represents an implementation error. Either alter the reference so it does not  match this component, or alter your workflow to ensure that the component is instantiated by the time this reference resolves'),b.initDependent(a,d),g=a[d])}return g}},b.frameworkGrades=["fluid.component","fluid.modelComponent","fluid.viewComponent","fluid.rendererComponent"],b.filterBuiltinGrades=function(a){return b.remove_if(b.makeArray(a),function(a){return-1!==b.frameworkGrades.indexOf(a)})},b.dumpGradeNames=function(a){return a.options&&a.options.gradeNames?" gradeNames: "+JSON.stringify(b.filterBuiltinGrades(a.options.gradeNames)):""},b.dumpThat=function(a){return'{ typeName: "'+a.typeName+'"'+b.dumpGradeNames(a)+" id: "+a.id+"}"},b.dumpThatStack=function(a,c){var d=b.transform(a,function(a){var d=c.idToPath(a.id);return b.dumpThat(a)+(d?" - path: "+d:"")});return d.join("\n")},b.resolveContext=function(a,c,d){if("that"===a)return c;var e,f=b.globalInstantiator;if(d){var g=f.idToShadow[c.id];return g.ownScope[a]}var h=f.getFullStack(c);return b.visitComponentsForVisibility(f,h,function(c,d){var f=b.shadowForComponent(c);return a===d||f&&f.contextHash&&f.contextHash[a]||a===c.typeName?(e=c,!0):b.getForComponent(c,["options","components",a])&&!c[a]?(e=b.getForComponent(c,a),!0):void 0}),e},b.makeStackFetcher=function(a,c,d){var e=function(e){a&&"destroyed"===a.lifecycleStatus&&b.fail("Cannot resolve reference "+b.renderContextReference(e)+" from component "+b.dumpThat(a)+" which has been destroyed");var f=e.context;if(c&&f in c)return b.get(c[f],e.path);var g=b.resolveContext(f,a,d);if(!g&&""!==e.path){var h=b.renderContextReference(e);b.fail("Failed to resolve reference "+h+" - could not match context with name "+f+" from component "+b.dumpThat(a)+" at path "+b.pathForComponent(a).join(".")+" component: ",a)}return b.getForComponent(g,e.path)};return e},b.makeStackResolverOptions=function(c,d,e){return a.extend(b.copy(b.rawDefaults("fluid.makeExpandOptions")),{localRecord:d||{},fetcher:b.makeStackFetcher(c,d,e),contextThat:c,exceptions:{members:{model:!0,modelRelay:!0}}})},b.clearListeners=function(a){b.each(a.listeners,function(a){a.event.removeListener(a.listenerId||a.listener)}),delete a.listeners},b.recordListener=function(a,c,d,e){a.ownerId!==d.that.id&&b.pushArray(d,"listeners",{event:a,listener:c,listenerId:e})},b.constructScopeObjects=function(a,b,c,d){var e=b?a.idToShadow[b.id]:null;d.childrenScope=e?Object.create(e.ownScope):{},d.ownScope=Object.create(d.childrenScope),d.parentShadow=e},b.clearChildrenScope=function(a,c,d,e){b.each(e.contextHash,function(a,b){c.childrenScope[b]===d&&delete c.childrenScope[b]})},b.instantiator=function(){function c(a,c,e,f,g){var h;if(g)h=d.idToShadow[c.id]={},h.that=c,h.path=e,h.memberName=f,b.constructScopeObjects(d,a,c,h);else{h=d.idToShadow[c.id],h.injectedPaths=h.injectedPaths||{},h.injectedPaths[e]=!0;var i=d.idToShadow[a.id],j=b.keys(h.contextHash);b.remove_if(j,function(a){return h.contextHash&&"memberName"===h.contextHash[a]}),j.push(f),b.each(j,function(a){i.childrenScope[a]||(i.childrenScope[a]=c)})}d.pathToComponent[e]&&b.fail("Error during instantiation - path "+e+" which has just created component "+b.dumpThat(c)+" has already been used for component "+b.dumpThat(d.pathToComponent[e])+" - this is a circular instantiation or other oversight. Please clear the component using instantiator.clearComponent() before reusing the path."),d.pathToComponent[e]=c}var d=b.typeTag("instantiator");return a.extend(d,{lifecycleStatus:"constructed",pathToComponent:{},idToShadow:{},modelTransactions:{init:{}},composePath:b.model.composePath,composeSegments:b.model.composeSegments,parseEL:b.model.parseEL,events:{onComponentAttach:b.makeEventFirer({name:"instantiator's onComponentAttach event"}),onComponentClear:b.makeEventFirer({name:"instantiator's onComponentClear event"})}}),d.idToPath=function(a){var b=d.idToShadow[a];return b?b.path:""},d.getThatStack=function(a){var b=d.idToShadow[a.id];if(b){for(var c=b.path,e=d.parseEL(c),f=d.pathToComponent[""],g=[],h=0;h<e.length;++h)f=f[e[h]],g.push(f);return g}return[]},d.getFullStack=function(a){var c=a?d.getThatStack(a):[];return c.unshift(b.resolveRootComponent),c},d.recordRoot=function(a){c(null,a,"","",!0)},d.recordKnownComponent=function(a,e,f,g){if(a[f]=e,b.isComponent(e)||"instantiator"===e.type){var h=d.idToShadow[a.id].path,i=d.composePath(h,f);c(a,e,i,f,g),d.events.onComponentAttach.fire(e,i,d,g)}else b.fail("Cannot record non-component with value ",e,' at path "'+f+'" of parent ',a)},d.clearComponent=function(a,c,e,f,g,h){var i=d.idToShadow[a.id];f=f||{flat:!0,instantiator:d},e=e||a[c],h=h||i.path,void 0===h&&b.fail("Cannot clear component "+c+" from component ",a," which was not created by this instantiator");var j=d.composePath(h,c),k=d.idToShadow[e.id];if(k){var l=k.path===j;d.events.onComponentClear.fire(e,j,a,l),l?(b.each(k.injectedPaths,function(a,c){var f=b.model.getToTailPath(c),g=d.pathToComponent[f];d.clearComponent(g,b.model.getTailPath(c),e)}),b.visitComponentChildren(e,function(a,b,c,g){var h=d.composeSegments.apply(null,c.slice(0,g));d.clearComponent(e,b,null,f,!0,h)},f,d.parseEL(j)),b.doDestroy(e,c,a),b.clearDistributions(k),b.clearListeners(k),e.events.afterDestroy.fire(e,c,a),delete d.idToShadow[e.id]):b.remove_if(k.injectedPaths,function(a,b){return b===j}),b.clearChildrenScope(d,i,e,k),delete d.pathToComponent[j],g||delete a[c]}},d},b.globalInstantiator=b.instantiator(),b.getInstantiator=function(a){var c=b.globalInstantiator;return a&&c.idToShadow[a.id]?c:null},b.defaults("fluid.resolveRoot"),b.defaults("fluid.resolveRootSingle",{gradeNames:"fluid.resolveRoot"}),b.constructRootComponents=function(a){b.rootComponent=a.rootComponent=b.typeTag("fluid.rootComponent"),a.recordRoot(b.rootComponent),b.resolveRootComponent=a.resolveRootComponent=b.typeTag("fluid.resolveRootComponent"),a.recordKnownComponent(b.rootComponent,b.resolveRootComponent,"resolveRootComponent",!0);var c=a.idToShadow[b.rootComponent.id],d=a.idToShadow[b.resolveRootComponent.id];d.ownScope=c.ownScope,d.childrenScope=c.childrenScope,a.recordKnownComponent(b.resolveRootComponent,a,"instantiator",!0),d.childrenScope.instantiator=a},b.constructRootComponents(b.globalInstantiator),b.expandOptions=function(a,c,d,e,f){if(!a)return a;b.pushActivity("expandOptions","expanding options %args for component %that ",{that:c,args:a});var g=b.makeStackResolverOptions(c,e);g.mergePolicy=d;var h=f&&f.defer?b.makeExpandOptions(a,g):b.expand(a,g);return b.popActivity(),h},b.localRecordExpected=b.arrayToHash(["type","options","container","createOnEvent","priority","recordType"]),b.checkComponentRecord=function(a){b.each(a,function(c,d){b.localRecordExpected[d]||b.fail("Probable error in subcomponent record ",a,' - key "'+d+'" found, where the only legal options are '+b.keys(b.localRecordExpected).join(", "))})},b.mergeRecordsToList=function(a,c){var d=[];return b.each(c,function(c,e){if(c.recordType=e,"distributions"===e)d.push.apply(d,b.transform(c,function(c){return b.computeDistributionPriority(a,c)}));else{if(!c.options)return;c.priority=b.mergeRecordTypes[e],void 0===c.priority&&b.fail("Merge record with unrecognised type "+e+": ",c),d.push(c)}}),d};var d=function(a){return b.each(["gradeNames","mergePolicy","argumentMap","components","dynamicComponents","events","listeners","modelListeners","modelRelay","distributeOptions","transformOptions"],function(c){b.set(a,[c,"*","noexpand"],!0)}),a};b.generateExpandBlock=function(a,c,d,e){var f=b.expandOptions(a.options,a.contextThat||c,d,e,{defer:!0});return f.priority=a.priority,f.namespace=a.namespace,f.recordType=a.recordType,f};var e=function(c,e,f,g){var h=b.copy(e);d(c);var i=b.shadowForComponent(g);i.mergePolicy=c;var j={defaults:{options:h}};a.extend(j,f.mergeRecords),j.subcomponentRecord&&b.checkComponentRecord(j.subcomponentRecord);var k=b.mergeRecordsToList(g,j),l=b.transform(k,function(a){return b.generateExpandBlock(a,g,c,f.localRecord)});return l};b.fabricateDestroyMethod=function(a,b,c,d){return function(){c.clearComponent(a,b,d)}},b.computeGlobalMemberName=function(a){var c=b.computeNickName(a.typeName);return c+"-"+a.id},b.typeNameToMemberName=function(a){return a.replace(/\./g,"_")},b.expandComponentOptions=function(a,c,d,f){var g=d,h=d&&d.marker===b.EXPAND?d.instantiator:null;b.pushActivity("expandComponentOptions","expanding component options %options with record %record for component %that",{options:h?d.mergeRecords.user:d,record:g,that:f}),h||(h=b.globalInstantiator,g={mergeRecords:{user:{options:b.expandCompact(d,!0)}},memberName:b.computeGlobalMemberName(f),instantiator:h,parentThat:b.rootComponent}),f.destroy=b.fabricateDestroyMethod(g.parentThat,g.memberName,h,f),h.recordKnownComponent(g.parentThat,f,g.memberName,!0);var i=e(a,c,g,f);return b.popActivity(),i},b.assembleCreatorArguments=function(c,d,e){var f=b.defaults(d);f&&f.argumentMap||b.fail("Error in assembleCreatorArguments: cannot look up component type name "+d+" to a component creator grade with an argumentMap");var g={},h=c?b.receiveDistributions(c,f.gradeNames,e.memberName,g):[];b.each(h,function(a){b.computeDistributionPriority(c,a),b.isPrimitive(a.priority)&&(a.priority=b.parsePriority(a.priority,0,!1,"options distribution"))}),b.sortByPriority(h);var i=e.localDynamic,j=a.extend({},b.censorKeys(e.componentRecord,["type"]),i),k=f.argumentMap,l=Object.keys(k).concat(["type"]);b.each(l,function(a){for(var b=0;b<h.length;++b)void 0!==h[b][a]&&(j[a]=h[b][a])}),d=j.type||d,delete j.type,delete j.options;var m={distributions:h};void 0!==e.componentRecord&&(m.subcomponentRecord=a.extend({},e.componentRecord));var n=[];b.each(k,function(a,d){var f;if("options"===d)f={marker:b.EXPAND,localRecord:i,mergeRecords:m,instantiator:b.getInstantiator(c),parentThat:c,memberName:e.memberName};else{var g=j[d];f=b.expandImmediate(g,c,j)}n[a]=f});var o={args:n,funcName:d};return o},b.initDependent=function(a,c,d){if(!a[c]){var e,f=a.options.components[c],g=b.globalInstantiator,h=g.idToShadow[a.id],i=d||h.subcomponentLocal&&h.subcomponentLocal[c];if(b.pushActivity("initDependent",'instantiating dependent component at path "%path" with record %record as child of %parent',{
path:h.path+"."+c,record:f,parent:a}),"string"==typeof f)a[c]=b.inEvaluationMarker,e=b.expandImmediate(f,a),e?g.recordKnownComponent(a,e,c,!1):delete a[c];else if(f.type){var j=b.expandImmediate(f.type,a,i);j||b.fail("Error in subcomponent record: ",f.type," could not be resolved to a type for component ",c," of parent ",a);var k=b.assembleCreatorArguments(a,j,{componentRecord:f,memberName:c,localDynamic:i});e=b.initSubcomponentImpl(a,{type:k.funcName},k.args)}else b.fail("Unrecognised material in place of subcomponent "+c+' - no "type" field found');return b.popActivity(),e}},b.bindDeferredComponent=function(a,c,d){var e=b.makeArray(d.createOnEvent);b.each(e,function(e){var f="{"===e.charAt(0)?b.expandOptions(e,a):a.events[e];f&&f.addListener||b.fail("Error instantiating createOnEvent component with name "+c+" of parent ",a," since event specification "+e+" could not be expanded to an event - got ",f),f.addListener(function(){b.pushActivity("initDeferred","instantiating deferred component %componentName of parent %that due to event %eventName",{componentName:c,that:a,eventName:e}),a[c]&&b.globalInstantiator.clearComponent(a,c),b.initDependent(a,c),b.popActivity()},null,d.priority)})},b.priorityForComponent=function(a){return a.priority?a.priority:"fluid.typeFount"===a.type||b.hasGrade(b.defaults(a.type),"fluid.typeFount")?"first":void 0},b.initDependents=function(a){b.pushActivity("initDependents","instantiating dependent components for component %that",{that:a});var c=b.shadowForComponent(a);if(c.memberStrategy.initter(),c.invokerStrategy.initter(),b.getForComponent(a,"modelRelay"),b.getForComponent(a,"model"),!b.isDestroyed(a)){var d=a.options,e=d.components||{},f=[];b.each(e,function(c,d){if(c.createOnEvent)b.bindDeferredComponent(a,d,c);else{var e=b.priorityForComponent(c);f.push({namespace:d,priority:b.parsePriority(e)})}}),b.sortByPriority(f),b.each(f,function(c){b.initDependent(a,c.namespace)}),c.subcomponentLocal&&b.clear(c.subcomponentLocal),a.lifecycleStatus="constructed",b.assessTreeConstruction(a,c),b.popActivity()}},b.assessTreeConstruction=function(a,c){var d=b.globalInstantiator,e=d.getThatStack(a),f=b.find_if(e,function(a){return"constructing"===a.lifecycleStatus});f?a.lifecycleStatus="constructed":b.markSubtree(d,a,c.path,"treeConstructed")},b.markSubtree=function(a,c,d,e){c.lifecycleStatus=e,b.visitComponentChildren(c,function(c,f){var g=a.composePath(d,f),h=a.idToShadow[c.id],i=h&&h.path===g;i&&b.markSubtree(a,c,g,e)},{flat:!0})},b.pathForComponent=function(a,c){c=c||b.getInstantiator(a);var d=c.idToShadow[a.id];return d||b.fail("Cannot get path for ",a," which is not a component"),c.parseEL(d.path)},b.construct=function(a,c,d){var e=b.destroy(a,d);return b.set(e.parent,["options","components",e.memberName],{type:c.type,options:c}),b.initDependent(e.parent,e.memberName)},b.destroy=function(a,c){c=c||b.globalInstantiator;var d=b.model.parseToSegments(a,c.parseEL,!0);0===d.length&&b.fail("Cannot destroy the root component");var e=d.pop(),f=c.composeSegments.apply(null,d),g=c.pathToComponent[f];return g||b.fail("Cannot modify component with nonexistent parent at path ",a),g[e]&&g[e].destroy(),{parent:g,memberName:e}},b.constructSingle=function(c,d,e){e=e||b.globalInstantiator,c=c||"";var f=b.model.parseToSegments(c,e.parseEL,!0);"string"==typeof d&&(d={type:d});var g=d.type;g||b.fail("Cannot construct singleton object without a type entry"),d=a.extend({},d);var h=d.gradeNames=b.makeArray(d.gradeNames);h.unshift(g),d.type="fluid.component";var i=0===f.length;i&&h.push("fluid.resolveRoot");var j=b.typeNameToMemberName(d.singleRootType||g);f.push(j),b.construct(f,d,e)},b.destroySingle=function(a,c,d){d=d||b.globalInstantiator;var e=b.model.parseToSegments(a,d.parseEL,!0),f=b.typeNameToMemberName(c);e.push(f),b.destroy(e,d)},b.makeGradeLinkage=function(a,c,d){b.defaults(a,{gradeNames:"fluid.component",distributeOptions:{record:d,target:"{/ "+c.join("&")+"}.options.gradeNames"}}),b.constructSingle([],a)},b["debugger"]=function(){},b.defaults("fluid.debuggingProbe",{gradeNames:["fluid.component"]}),b.probeToDistribution=function(a){var c=b.globalInstantiator,d=b.parseContextReference(a.target),e=b.model.parseToSegments(d.path,c.parseEL,!0);"options"!==e[0]&&e.unshift("options");var f=b.parsePriority(a.priority);return f.constraint&&!f.constraint.target&&(f.constraint.target="authoring"),{target:"{/ "+d.context+"}."+c.composeSegments.apply(null,e),record:{func:a.func,funcName:a.funcName,args:a.args,priority:b.renderPriority(f)}}},b.registerProbes=function(a){var c=b.transform(a,b.probeToDistribution),d="fluid_debuggingProbe_"+b.allocateGuid();return b.construct([d],{type:"fluid.debuggingProbe",distributeOptions:c}),d},b.deregisterProbes=function(a){b.destroy([a])},b.thisistToApplicable=function(a,c,d){return{apply:function(e,f){var g=b.expandOptions(c,d);"string"==typeof g&&(g=b.getGlobalValue(g)),g||b.fail("Could not resolve reference "+c+" to a value");var h=g[a.method];return"function"!=typeof h&&b.fail("Object ",g," at reference "+c+" has no member named "+a.method+" which is a function "),b.log("Applying arguments ",f," to method "+a.method+" of instance ",g),h.apply(g,f)}}},b.changeToApplicable=function(a,c){return{apply:function(d,e,f,g){var h=b.parseValidModelReference(c,"changePath listener record",a.changePath),i=b.expandOptions(a.value,c,{},b.extend(f,{arguments:e})),j=g&&g.source&&g.source.length?b.makeArray(a.source).concat(g.source):a.source;h.applier.change(h.modelSegs,i,a.type,j)}}},b.recordToApplicable=function(a,c,d){if(void 0!==a.changePath)return b.changeToApplicable(a,c,d);var e=a["this"];return a.method^e&&b.fail("Record ",c,' must contain both entries "method" and "this" if it contains either'),a.method?b.thisistToApplicable(a,e,c):null},b.getGlobalValueNonComponent=function(a,c){var d=b.defaults(a);return d&&b.hasGrade(d,"fluid.component")&&b.fail("Error in function specification - cannot invoke function "+a+" in the context of "+c+": component creator functions can only be used as subcomponents"),b.getGlobalValue(a)},b.makeInvoker=function(a,c,d){c=b.upgradePrimitiveFunc(c),void 0===c.args||c.args===b.NO_VALUE||b.isArrayable(c.args)||(c.args=b.makeArray(c.args));var e=b.recordToApplicable(c,a),f=b.preExpand(c.args),g={},h=b.makeStackResolverOptions(a,g,!0);return e=e||(c.funcName?b.getGlobalValueNonComponent(c.funcName,"an invoker"):b.expandImmediate(c.func,a)),e&&e.apply?e===b.notImplemented&&b.fail("Error constructing component ",a," - the invoker named "+d+" which was defined in grade "+c.componentSource+" needs to be overridden with a concrete implementation"):b.fail("Error in invoker record: could not resolve members func, funcName or method to a function implementation - got "+e+" from ",c),function(){b.defeatLogging===!1&&b.pushActivity("invokeInvoker","invoking invoker with name %name and record %record from component %that",{name:d,record:c,that:a});var i,j;return g.arguments=arguments,void 0===c.args||c.args===b.NO_VALUE?j=arguments:(b.expandImmediateImpl(f,h),j=f.source),i=e.apply(null,j),b.defeatLogging===!1&&b.popActivity(),i}},b.event.makeTrackedListenerAdder=function(a){var c=b.shadowForComponent(a);return function(a){return{addListener:function(d,e,f,g,h){b.recordListener(a,d,c,h),a.addListener.apply(null,arguments)}}}},b.event.listenerEngine=function(a,c,d){function e(){var d=b.find(a,function(a,b){return void 0===f[b]?!0:void 0});if(!d){var e=f;f={},c(e)}}var f={};b.each(a,function(a,c){d(a).addListener(function(){f[c]=b.makeArray(arguments),e()})})},b.event.dispatchListener=function(a,c,d,e,f){void 0===e.args||e.args===b.NO_VALUE||b.isArrayable(e.args)||(e.args=b.makeArray(e.args)),c=b.event.resolveListener(c);var g=b.preExpand(e.args),h={},i=b.makeStackResolverOptions(a,h,!0),j=function(){b.defeatLogging===!1&&b.pushActivity("dispatchListener","firing to listener to event named %eventName of component %that",{eventName:d,that:a});var j,k=f?arguments[0]:arguments;h.arguments=k,void 0!==e.args&&e.args!==b.NO_VALUE?(b.expandImmediateImpl(g,i),j=g.source):j=k;var l=c.apply(null,j);return b.defeatLogging===!1&&b.popActivity(),l};return b.event.impersonateListener(c,j),j},b.event.resolveSoftNamespace=function(a){if("string"!=typeof a)return null;var b=Math.max(a.lastIndexOf("."),a.lastIndexOf("}"));return a.substring(b+1)},b.event.resolveListenerRecord=function(a,c,d,e,f){var g=function(a,c){b.fail("Error in listener record - could not resolve reference ",a,' to a listener or firer. Did you miss out "events." when referring to an event firer?'+c)};b.pushActivity("resolveListenerRecord","resolving listener record for event named %eventName for component %that",{eventName:d,that:c});var h=b.makeArray(a),i=b.transform(h,function(a){var h=b.isPrimitive(a)||a.expander?{listener:a}:b.copy(a),i=b.recordToApplicable(a,c,f);i?h.listener=i:h.listener=h.listener||h.func||h.funcName,h.listener||g(a,' Listener record must contain a member named "listener", "func", "funcName" or "method"');var j=a.method?b.event.resolveSoftNamespace(a["this"])+"."+a.method:b.event.resolveSoftNamespace(h.listener);h.namespace||e||!j||(h.softNamespace=!0,h.namespace=(a.componentSource?a.componentSource:c.typeName)+"."+j);var k=h.listener=b.expandOptions(h.listener,c);k||g(a,"");var l=!1;return"fluid.event.firer"===k.typeName&&(k=k.fire,l=!0),h.listener=f&&(h.args&&"fluid.notImplemented"!==k||l)?b.event.dispatchListener(c,k,d,h):k,h.listenerId=b.allocateGuid(),h}),j={records:i,adderWrapper:f?b.event.makeTrackedListenerAdder(c):null};return b.popActivity(),j},b.event.expandOneEvent=function(a,c){var d;return d="string"==typeof c&&"{"!==c.charAt(0)?b.getForComponent(a,["events",c]):b.expandOptions(c,a),d&&"fluid.event.firer"===d.typeName||b.fail("Error in event specification - could not resolve base event reference ",c," to an event firer: got ",d),d},b.event.expandEvents=function(a,c){return"string"==typeof c?b.event.expandOneEvent(a,c):b.transform(c,function(c){return b.event.expandOneEvent(a,c)})},b.event.resolveEvent=function(a,c,d){b.pushActivity("resolveEvent","resolving event with name %eventName attached to component %that",{eventName:c,that:a});var e=b.event.makeTrackedListenerAdder(a);"string"==typeof d&&(d={event:d});var f="fluid.event.firer"===d.typeName?d:d.event||d.events;f||b.fail("Event specification for event with name "+c+" does not include a base event specification: ",d);var g,h="fluid.event.firer"===f.typeName?f:b.event.expandEvents(a,f),i="fluid.event.firer"!==h.typeName,j=d.args||i;if(j){g=b.makeEventFirer({name:" [composite] "+b.event.nameEvent(a,c)});var k=b.event.dispatchListener(a,g.fire,c,d,i);i?b.event.listenerEngine(h,k,e):e(h).addListener(k)}else g={typeName:"fluid.event.firer"},g.fire=function(){var a=b.makeArray(arguments);b.pushActivity("fireSynthetic","firing synthetic event %eventName ",{eventName:c});var d=h.fire.apply(null,a);return b.popActivity(),d},g.addListener=function(f,g,i,j,k){var l=b.event.dispatchListener(a,f,c,d);e(h).addListener(l,g,i,j,k)},g.removeListener=function(a){h.removeListener(a)};return b.popActivity(),g},b.withEnvironment=function(c,d,e){e=e||b.globalThreadLocal();try{for(var f in c)e[f]=c[f];return a.extend(e,c),d()}finally{for(var f in c)delete e[f]}},b.fetchContextReference=function(a,c,d,e,f){e&&(a=e(a,d));var g=a.context?d[a.context]:c;if(!g){var h=f&&f(a);return h||g}return a.noDereference?a.path:b.get(g,a.path)},b.makeEnvironmentFetcher=function(a,c,d,e){return d=d||b.globalThreadLocal,function(f){var g=d();return b.fetchContextReference(f,a,g,c,e)}},b.coerceToPrimitive=function(a){return"false"===a?!1:"true"===a?!0:isFinite(a)?Number(a):a},b.compactStringToRec=function(c,d){var e=c.indexOf("("),f=c.indexOf(")");if((-1===e^-1===f||e>f)&&b.fail("Badly-formed compact "+d+" record without matching parentheses: "+c),-1!==e&&-1!==f){var g=c.substring(f+1);""!==a.trim(g)&&b.fail("Badly-formed compact "+d+" record "+c+" - unexpected material following close parenthesis: "+g);var h=c.substring(0,e),i=c.substring(e+1,f),j=b.transform(i.split(","),a.trim,b.coerceToPrimitive),k=b.upgradePrimitiveFunc(h,null);return k.args=j,k}return"expander"===d&&b.fail("Badly-formed compact expander record without parentheses: "+c),c},b.expandPrefix="@expand:",b.expandCompactString=function(a,c){var d=a;if(0===a.indexOf(b.expandPrefix)){var e=a.substring(b.expandPrefix.length);d={expander:b.compactStringToRec(e,"expander")}}else c&&(d=b.compactStringToRec(a,c));return d};var f={listeners:"listener",modelListeners:"modelListener"},g=a.extend({invokers:"invoker"},f);b.expandCompactRec=function(a,c,d){b.guardCircularExpansion(a,a.length);var e=a.length>0?a[a.length-1]:"",h=g[e];!h&&a.length>1&&(h=f[a[a.length-2]]),b.each(d,function(d,e){return b.isPlainObject(d)?(c[e]=b.freshContainer(d),a.push(e),b.expandCompactRec(a,c[e],d),void a.pop()):("string"==typeof d&&(d=b.expandCompactString(d,h)),void(c[e]=d))})},b.expandCompact=function(a){var c={};return b.expandCompactRec([],c,a),c},b.isIoCReference=function(a){return"string"==typeof a&&"{"===a.charAt(0)&&a.indexOf("}")>0},b.extractEL=function(a,b){if("ALL"===b.ELstyle)return a;if(1===b.ELstyle.length){if(a.charAt(0)===b.ELstyle)return a.substring(1)}else if("${}"===b.ELstyle){var c=a.indexOf("${"),d=a.lastIndexOf("}");if(0===c&&-1!==d)return a.substring(2,d)}},b.extractELWithContext=function(a,c){var d=b.extractEL(a,c);return b.isIoCReference(d)?b.parseContextReference(d):d?{path:d}:d},b.parseContextReference=function(a,c,d){c=c||0;var e=a.indexOf("}",c+1);-1===e&&b.fail('Cannot parse context reference "'+a+'": Malformed context reference without }');var f=a.substring(c+1,e),g=d?a.indexOf(d,e+1):a.length,h=a.substring(e+1,g);return"."===h.charAt(0)&&(h=h.substring(1)),{context:f,path:h,endpos:g}},b.renderContextReference=function(a){return"{"+a.context+"}"+(a.path?"."+a.path:"")},b.resolveContextValue=function(a,c){function d(d){b.pushActivity("resolveContextValue","resolving context value %string",{string:a});var e=c.fetcher(d);return b.pushActivity("resolvedContextValue","resolved value %string to value %value",{string:a,value:e}),b.popActivity(2),e}var e;if(c.bareContextRefs&&b.isIoCReference(a))return e=b.parseContextReference(a),d(e);if(c.ELstyle&&"${}"!==c.ELstyle&&(e=b.extractELWithContext(a,c)))return d(e);for(;"string"==typeof a;){var f=a.indexOf("${"),g=a.indexOf("}",f+2);if(-1===f||-1===g)break;"{"===a.charAt(f+2)?(e=b.parseContextReference(a,f+2,"}"),g=e.endpos):e={path:a.substring(f+2,g)};var h=d(e),i=0===f&&g===a.length-1;if(void 0===h||null===h)return h;a=i?h:a.substring(0,f)+h+a.substring(g+1)}return a},b.fetchExpandChildren=function(c,d,e,f,g,h){if(f.expander){var i=b.expandExpander(c,f,h);if(b.isPrimitive(i)||!b.isPlainObject(i)||b.isArrayable(i)^b.isArrayable(c))return i;a.extend(!0,c,i)}return b.each(f,function(a,i){void 0===a?c[i]=void 0:"expander"!==i&&(e[d]=i,b.getImmediate(h.exceptions,e,d)!==!0&&h.strategy(c,i,d+1,e,f,g))}),c},b.isUnexpandable=function(a){return b.isPrimitive(a)||!b.isPlainObject(a)},b.expandSource=function(a,c,d,e,f,g,h,i){var j,k,l=b.derefMergePolicy(h);return"string"!=typeof g||l.noexpand?l.noexpand||b.isUnexpandable(g)?j=g:g.expander?j=b.expandExpander(f,g,a):(j=b.freshContainer(g),k=!0):a.defaultEL&&"{"!==g.charAt(0)?j=g:(b.pushActivity("expandContextValue","expanding context value %source held at path %path",{source:g,path:b.path.apply(null,e.slice(0,d))}),j=b.resolveContextValue(g,a),b.popActivity(1)),j!==b.NO_VALUE&&f(j),k&&i(j,g,d,e,h),j},b.guardCircularExpansion=function(a,c){c>b.strategyRecursionBailout&&b.fail("Overflow/circularity in options expansion, current path is ",a," at depth ",c,' - please ensure options are not circularly connected, or protect from expansion using the "noexpand" policy or expander')},b.makeExpandStrategy=function(a){var d=function(c,d,e,f,g){return b.fetchExpandChildren(c,e||0,f||[],d,g,a)},e=function(e,f,g,h,i,j){function k(a){e[f]=a}if(b.guardCircularExpansion(h,g),e){if(e.hasOwnProperty(f))return e[f];void 0===i&&(i=c(a.source,h,g-1,a.sourceStrategy),j=c(a.mergePolicy,h,g-1,b.concreteTrundler));var l=a.sourceStrategy(i,f,g,h),m=b.concreteTrundler(j,f);return b.expandSource(a,e,g,h,k,l,m,d)}};return a.recurse=d,a.strategy=e,e},b.defaults("fluid.makeExpandOptions",{ELstyle:"${}",bareContextRefs:!0,target:b.inCreationMarker}),b.makeExpandOptions=function(c,d){return d=a.extend({},b.rawDefaults("fluid.makeExpandOptions"),d),d.defaultEL="${}"===d.ELStyle&&d.bareContextRefs,d.expandSource=function(a){return b.expandSource(d,null,0,[],b.identity,a,d.mergePolicy,!1)},b.isUnexpandable(c)?(d.strategy=b.concreteTrundler,d.initter=b.identity,"string"==typeof c?d.target=d.expandSource(c):d.target=c):(d.source=c,d.target=b.freshContainer(c),d.sourceStrategy=d.sourceStrategy||b.concreteTrundler,b.makeExpandStrategy(d),d.initter=function(){d.target=b.fetchExpandChildren(d.target,0,[],d.source,d.mergePolicy,d)}),d},b.expand=function(a,c){var d=b.makeExpandOptions(a,c);return d.initter(),d.target},b.preExpandRecurse=function(a,c,d,e,f){function g(b){a.expanders.push({expander:b,holder:d,member:e}),delete d[e]}if(b.guardCircularExpansion(f,f.length),b.isIoCReference(c)){var h=b.parseContextReference(c),i=b.model.parseEL(h.path);g({typeFunc:b.expander.fetch,context:h.context,segs:i})}else b.isPlainObject(c)&&(c.expander?(c.expander.typeFunc=b.getGlobalValue(c.expander.type||"fluid.invokeFunc"),g(c.expander)):b.each(c,function(d,e){f.push(e),b.preExpandRecurse(a,d,c,e,f),f.pop()}))},b.preExpand=function(a){var c={expanders:[],source:b.isUnexpandable(a)?a:b.copy(a)};return b.preExpandRecurse(c,c.source,c,"source",[]),c},b.expandImmediate=function(a,c,d){var e=b.makeStackResolverOptions(c,d,!0),f=b.preExpand(a);return b.expandImmediateImpl(f,e),f.source},b.expandImmediateImpl=function(a,b){for(var c=a.expanders,d=0;d<c.length;++d){var e=c[d];e.holder[e.member]=e.expander.typeFunc(null,e,b)}},b.expandExpander=function(a,c,d){var e=b.getGlobalValue(c.expander.type||"fluid.invokeFunc");return e||b.fail("Unknown expander with type "+c.expander.type),e(a,c,d)},b.registerNamespace("fluid.expander"),b.expander.fetch=function(a,c,d){var e=d.localRecord,f=c.expander.context,g=c.expander.segs,h=void 0!==e[f],i=h?e[f]:b.resolveContext(f,d.contextThat,"treeConstructed"===d.contextThat.lifecycleStatus);if(i){var j=i;if(h||"constructed"===i.lifecycleStatus||"treeConstructed"===i.lifecycleStatus)for(var k=0;k<g.length;++k)j=j?j[g[k]]:void 0;else"destroyed"!==i.lifecycleStatus?j=b.getForComponent(i,g):b.fail("Cannot resolve path "+g.join(".")+" into component ",i," which has been destroyed");return void 0!==j||h||(j=b.getForComponent(i,g)),j}},b.invokeFunc=function(a,c,d){var e=c.expander,f=b.makeArray(e.args);e.args=f,d.recurse?f=d.recurse([],f):(e=b.expandImmediate(e,d.contextThat,d.localRecord),f=e.args);var g=e.func||e.funcName,h=(d.expandSource?d.expandSource(g):g)||b.recordToApplicable(e,d.contextThat);return"string"==typeof h&&(h=b.getGlobalValue(h)),h||b.fail("Error in expander record ",e,": "+g+" could not be resolved to a function for component ",d.contextThat),h.apply(null,f)},b.noexpand=function(a,b){return b.expander.value?b.expander.value:b.expander.tree}}(jQuery,fluid_2_0_0);var fluid_2_0_0=fluid_2_0_0||{};!function(a,b){"use strict";b.model.makeEnvironmentStrategy=function(a){return function(b,c,d){return 0===d&&a[c]?a[c]:void 0}},b.model.defaultCreatorStrategy=function(a,b){return void 0===a[b]?(a[b]={},a[b]):void 0},b.model.defaultFetchStrategy=function(a,b){return a[b]},b.model.funcResolverStrategy=function(a,b){return a.resolvePathSegment?a.resolvePathSegment(b):void 0},b.model.traverseWithStrategy=function(a,c,d,e,f){for(var g=e.strategies,h=c.length-f,i=d;h>i;++i){if(!a)return a;for(var j,k=0;k<g.length&&(j=g[k](a,c[i],i+1,c),void 0===j);++k);j===b.NO_VALUE&&(j=void 0),a=j}return a},b.model.getValueAndSegments=function(a,c,d,e){return b.model.accessWithStrategy(a,c,b.NO_VALUE,d,e,!0)},b.model.makeTrundler=function(a){return function(c,d){return b.model.getValueAndSegments(c.root,d,a,c.segs)}},b.model.getWithStrategy=function(a,c,d,e){return b.model.accessWithStrategy(a,c,b.NO_VALUE,d,e)},b.model.setWithStrategy=function(a,c,d,e,f){b.model.accessWithStrategy(a,c,d,e,f)},b.model.accessWithStrategy=function(a,c,d,e,f,g){if(b.isPrimitive(c)||b.isArrayable(c))return b.model.accessImpl(a,c,d,e,f,g,b.model.traverseWithStrategy);var h=c.type||"default",i=e.resolvers[h];i||b.fail("Unable to find resolver of type "+h);var j=b.model.makeTrundler(e),k={root:a,segs:f};return k=i(k,c,j),c.path&&k&&(k=j(k,c.path)),g?k:k?k.root:void 0},b.registerNamespace("fluid.pathUtil"),b.pathUtil.getPathSegmentImpl=function(a,b,c){var d=null;a&&(d="");for(var e=!1,f=b.length;f>c;++c){var g=b.charAt(c);if(e)e=!1,null!==d&&(d+=g);else{if("."===g)break;"\\"===g?e=!0:null!==d&&(d+=g)}}return null!==d&&(a[0]=d),c};var c=[];b.pathUtil.parseEL=function(a){for(var d=[],e=0,f=a.length;f>e;){var g=b.pathUtil.getPathSegmentImpl(c,a,e);d.push(c[0]),e=g+1}return d},b.pathUtil.composeSegment=function(a,b){b=b.toString();for(var c=0;c<b.length;++c){var d=b.charAt(c);("."===d||"\\"===d||"}"===d)&&(a+="\\"),a+=d}return a},b.pathUtil.escapeSegment=function(a){return b.pathUtil.composeSegment("",a)},b.pathUtil.composePath=function(a,c){return 0!==a.length&&(a+="."),b.pathUtil.composeSegment(a,c)},b.pathUtil.composeSegments=function(){for(var a="",c=0;c<arguments.length;++c)a=b.pathUtil.composePath(a,arguments[c]);return a},b.pathUtil.matchSegments=function(a,b,c,d){if(d-c!==a.length)return!1;for(var e=c;d>e;++e)if(b[e]!==a[e-c])return!1;return!0},b.model.unescapedParser={parse:b.model.parseEL,compose:b.model.composeSegments},b.model.defaultGetConfig={parser:b.model.unescapedParser,strategies:[b.model.funcResolverStrategy,b.model.defaultFetchStrategy]},b.model.defaultSetConfig={parser:b.model.unescapedParser,strategies:[b.model.funcResolverStrategy,b.model.defaultFetchStrategy,b.model.defaultCreatorStrategy]},b.model.escapedParser={parse:b.pathUtil.parseEL,compose:b.pathUtil.composeSegments},b.model.escapedGetConfig={parser:b.model.escapedParser,strategies:[b.model.defaultFetchStrategy]},b.model.escapedSetConfig={parser:b.model.escapedParser,strategies:[b.model.defaultFetchStrategy,b.model.defaultCreatorStrategy]},b.initRelayModel=function(a){return b.deenlistModelComponent(a),a.model},b.isModelComplete=function(a){return"model"in a&&a.model!==b.inEvaluationMarker},b.enlistModelComponent=function(a){var c=b.getInstantiator(a),d=c.modelTransactions.init[a.id];return d||(d={that:a,applier:b.getForComponent(a,"applier"),complete:b.isModelComplete(a)},c.modelTransactions.init[a.id]=d),d},b.clearTransactions=function(){var a=b.globalInstantiator;b.clear(a.modelTransactions),a.modelTransactions.init={}},b.failureEvent.addListener(b.clearTransactions,"clearTransactions","before:fail"),b.clearLinkCounts=function(a,c){b.each(a,function(b,d){"number"==typeof b?a[d]=0:c&&b.options&&"number"==typeof b.relayCount&&(b.relayCount=0)})},b.sortCompleteLast=function(a,b){return(a.completeOnInit?1:0)-(b.completeOnInit?1:0)},b.operateInitialTransaction=function(a,c){var d,e=b.allocateGuid(),f=b.getModelTransactionRec(a,e),g=b.transform(c,function(a){return d=a.that.applier.initiate(null,"init",e),f[a.that.applier.applierId]={transaction:d},d}),h=b.values(c).sort(b.sortCompleteLast);b.each(h,function(a){var c=a.that,d=g[c.id];a.completeOnInit?b.initModelEvent(c,c.applier,d,c.applier.changeListeners.listeners):b.each(a.initModels,function(a){d.fireChangeRequest({type:"ADD",segs:[],value:a}),b.clearLinkCounts(f,!0)});var e=b.shadowForComponent(c);e&&(e.modelComplete=!0)}),d.commit()},b.deenlistModelComponent=function(a){var c=b.getInstantiator(a),d=c.modelTransactions.init;if(d[a.id]){a.model=void 0,d[a.id].complete=!0;var e=b.find_if(d,function(a){return a.complete!==!0});e||(b.operateInitialTransaction(a,d),c.modelTransactions.init={})}},b.parseModelReference=function(a,c){var d=b.parseContextReference(c);return d.segs=a.applier.parseEL(d.path),d},b.parseValidModelReference=function(a,c,d,e){var f,g=function(a){b.fail("Error in "+c+": ",d,a)};if("string"==typeof d)if("{"===d.charAt(0)){f=b.parseModelReference(a,d);var h=f.segs.indexOf("model");-1===h?e?f.nonModel=!0:g(' must be a reference into a component model via a path including the segment "model"'):(f.modelSegs=f.segs.slice(h+1),f.contextSegs=f.segs.slice(0,h),delete f.path)}else f={path:d,modelSegs:a.applier.parseEL(d)};else b.isArrayable(d.segs)||g(' must contain an entry "segs" holding path segments referring a model path within a component'),f={context:d.context,modelSegs:b.expandOptions(d.segs,a)};var i;return f.context?(i=b.resolveContext(f.context,a),i||g(" must be a reference to an existing component"),f.contextSegs&&(i=b.getForComponent(i,f.contextSegs))):i=a,f.nonModel||(i.applier||b.getForComponent(i,["applier"]),i.applier||g(" must be a reference to a component with a ChangeApplier (descended from fluid.modelComponent)")),f.that=i,f.applier=i.applier,f.path||(f.path=i.applier.composeSegments.apply(null,f.modelSegs)),f},b.getModelTransactionRec=function(a,c){var d=b.getInstantiator(a);if(c||b.fail("Cannot get transaction record without transaction id"),!d)return null;var e=d.modelTransactions[c];return e||(e=d.modelTransactions[c]={relays:[],sources:{},externalChanges:{}}),e},b.recordChangeListener=function(a,c,d,e){var f=b.shadowForComponent(a);b.recordListener(c.modelChanged,d,f,e)},b.registerRelayTransaction=function(a,c,d,e,f){var g=c.initiate("relay",null,d),h=a[c.applierId]={transaction:g,relayCount:0,namespace:f.namespace,priority:f.priority,options:e};return h.priority=b.parsePriority(h.priority,a.relays.length,!1,"model relay"),a.relays.push(h),h},b.relayRecursionBailout=100,b.registerDirectChangeRelay=function(a,c,d,e,f,g,h,i){var j=h.targetApplier||a.applier,k=h.sourceApplier||d.applier,l=j.applierId;c=b.makeArray(c),e=e?b.makeArray(e):e;var m=function(d,k,m,n,o,p){var q=o.id,r=b.getModelTransactionRec(a,q);p&&o&&!r[p.applierId]&&(r[p.applierId]={transaction:o});var s=r[l];r[f]=r[f]||0;var t=!0;t&&(++r[f],r[f]>b.relayRecursionBailout&&b.fail("Error in model relay specification at component ",a," - operated more than "+b.relayRecursionBailout+" relays without model value settling - current model contents are ",o.newHolder.model),s||(s=b.registerRelayTransaction(r,j,q,h,i)),g&&!h.targetApplier?g(s.transaction,h.sourceApplier?void 0:d,e,c):void 0!==d&&s.transaction.fireChangeRequest({type:"ADD",segs:c,value:d}))};m.relayListenerId=b.allocateGuid(),e&&(b.log(b.logLevel.TRACE,"Adding relay listener with id "+m.relayListenerId+" to source applier with id "+k.applierId+" from target applier with id "+l+" for target component with id "+a.id),k.modelChanged.addListener({isRelay:!0,segs:e,transactional:h.transactional},m)),d&&(b.recordChangeListener(d,k,m),a!==d&&b.recordChangeListener(a,k,m))},b.connectModelRelay=function(a,c,d,e,f){function g(a){var c=b.enlistModelComponent(a);if(c.complete){var d=b.shadowForComponent(a);d.modelComplete&&(c.completeOnInit=!0)}}var h=b.allocateGuid();g(d),g(a);var i=b.filterKeys(f,["namespace","priority"]);f.update?f.targetApplier?b.registerDirectChangeRelay(a,c,d,e,h,null,{transactional:!1,targetApplier:f.targetApplier,update:f.update},i):b.registerDirectChangeRelay(d,e,a,[],h+"-transform",f.forwardAdapter,{transactional:!0,sourceApplier:f.forwardApplier},i):(b.registerDirectChangeRelay(d,e,a,c,h,f.forwardAdapter,{transactional:!1},i),c&&b.registerDirectChangeRelay(a,c,d,e,h,f.backwardAdapter,{transactional:!1},i))},b.parseSourceExclusionSpec=function(a,c){return a.excludeSource=b.arrayToHash(b.makeArray(c.excludeSource||(c.includeSource?"*":void 0))),a.includeSource=b.arrayToHash(b.makeArray(c.includeSource)),a},b.isExcludedChangeSource=function(a,b){if(!b||!b.excludeSource)return!1;var c=b.excludeSource["*"];for(var d in a.fullSources)b.excludeSource[d]&&(c=!0),b.includeSource[d]&&(c=!1);return c},b.model.guardedAdapter=function(a,c,d,e){b.isExcludedChangeSource(a,c)||d.apply(null,e)},b.transformToAdapter=function(a,c){var d={};return d[c]=a,function(a,c){b.model.transformWithRules(c,d,{finalApplier:a})}},b.makeTransformPackage=function(a,c,d,e,f,g,h,i){var j={forwardHolder:{model:c},backwardHolder:{model:null}};j.generateAdapters=function(a){j.forwardAdapterImpl=b.transformToAdapter(a?a.newHolder.model:j.forwardHolder.model,e),null!==d&&(j.backwardHolder.model=b.model.transform.invertConfiguration(c),j.backwardAdapterImpl=b.transformToAdapter(j.backwardHolder.model,d))},j.forwardAdapter=function(a,c){void 0===c&&j.generateAdapters(),b.model.guardedAdapter(a,f,j.forwardAdapterImpl,arguments)},j.runTransform=function(a){a.commit(),a.reset()},j.forwardApplier=b.makeHolderChangeApplier(j.forwardHolder),j.forwardApplier.isRelayApplier=!0,j.invalidator=b.makeEventFirer({name:"Invalidator for model relay with applier "+j.forwardApplier.applierId}),null!==d&&(j.backwardApplier=b.makeHolderChangeApplier(j.backwardHolder),j.backwardAdapter=function(a){b.model.guardedAdapter(a,g,j.backwardAdapterImpl,arguments)}),j.update=j.invalidator.fire;var k={targetApplier:j.forwardApplier,update:j.update,namespace:h,priority:i,refCount:0};return j.forwardHolder.model=b.parseImplicitRelay(a,c,[],k),j.refCount=k.refCount,j.namespace=h,j.priority=i,j.generateAdapters(),j.invalidator.addListener(j.generateAdapters),j.invalidator.addListener(j.runTransform),j},b.singleTransformToFull=function(b){var c=a.extend(!0,{valuePath:""},b);return{"":{transform:c}}},b.model.relayConditions={initOnly:{includeSource:"init"},liveOnly:{excludeSource:"init"},never:{includeSource:[]},always:{}},b.model.parseRelayCondition=function(a){"initOnly"===a?b.log(b.logLevel.WARN,'The relay condition "initOnly" is deprecated: Please use the form \'includeSource: "init"\' instead'):"liveOnly"===a&&b.log(b.logLevel.WARN,'The relay condition "initOnly" is deprecated: Please use the form \'excludeSource: "init"\' instead');var c;return a?"string"==typeof a?(c=b.model.relayConditions[a],c||b.fail('Unrecognised model relay condition string "'+a+'": the supported values are "never" or a record with members "includeSource" and/or "excludeSource"')):c=a:c={},b.parseSourceExclusionSpec({},c)},b.parseModelRelay=function(a,c,d){var e=c.source?b.parseValidModelReference(a,'modelRelay record member "source"',c.source):{path:null,modelSegs:null},f=b.parseValidModelReference(a,'modelRelay record member "target"',c.target),g=c.namespace||d,h=c.singleTransform?b.singleTransformToFull(c.singleTransform):c.transform;h||b.fail('Cannot parse modelRelay record without element "singleTransform" or "transform":',c);var i=b.model.parseRelayCondition(c.forward),j=b.model.parseRelayCondition(c.backward),k=b.makeTransformPackage(a,h,e.path,f.path,i,j,g,c.priority);0===k.refCount?b.connectModelRelay(e.that||a,e.modelSegs,f.that,f.modelSegs,b.filterKeys(k,["forwardAdapter","backwardAdapter","namespace","priority"])):(e.modelSegs&&b.fail('Error in model relay definition: If a relay transform has a model dependency, you can not specify a "source" entry - please instead enter this as "input" in the transform specification. Definition was ',c," for component ",a),b.connectModelRelay(e.that||a,e.modelSegs,f.that,f.modelSegs,k))},b.parseImplicitRelay=function(a,c,d,e){var f;if("string"==typeof c&&"{"===c.charAt(0)){var g=b.parseValidModelReference(a,"model reference from model (implicit relay)",c,!0);g.nonModel?f=b.getForComponent(g.that,g.segs):(++e.refCount,b.connectModelRelay(a,d,g.that,g.modelSegs,e))}else b.isPrimitive(c)||!b.isPlainObject(c)?f=c:c.expander&&b.isPlainObject(c.expander)?f=b.expandOptions(c,a):(f=b.freshContainer(c),b.each(c,function(c,g){d.push(g);var h=b.parseImplicitRelay(a,c,d,e);void 0!==h&&(f[g]=h),d.pop()}));return f},b.model.notifyExternal=function(a){var c=a?b.values(a.externalChanges):[];b.sortByPriority(c);for(var d=0;d<c.length;++d){var e=c[d],f=e.args[5];f.destroyed||e.listener.apply(null,e.args)}b.clearLinkCounts(a,!0)},b.model.commitRelays=function(a,c){
var d=a.modelTransactions[c];b.each(d,function(a){a.transaction&&(a.transaction.commit("relay"),a.transaction.reset())})},b.model.updateRelays=function(a,c){var d=a.modelTransactions[c],e=0;return b.sortByPriority(d.relays),b.each(d.relays,function(a){a.transaction.changeRecord.changes>0&&a.relayCount<2&&a.options.update&&(a.relayCount++,b.clearLinkCounts(d),a.options.update(a.transaction,d),++e)}),e},b.establishModelRelay=function(a,c,d,e,f){function g(a){for(;b.model.updateRelays(l,a.id)>0;);}function h(a,c,d){"relay"!==d&&b.model.commitRelays(l,a.id)}function i(a,c,d){"relay"!==d&&(b.model.notifyExternal(l.modelTransactions[a.id]),delete l.modelTransactions[a.id])}b.mergeModelListeners(a,d);var j=b.enlistModelComponent(a);b.each(e,function(c,d){for(var e=0;e<c.length;++e)b.parseModelRelay(a,c[e],d)});var k=b.transform(c,function(c){return b.parseImplicitRelay(a,c,[],{refCount:0,priority:"first"})});j.initModels=k;var l=b.getInstantiator(a);return f.preCommit.addListener(g),f.preCommit.addListener(h),f.postCommit.addListener(i),null},b.defaults("fluid.modelComponent",{gradeNames:["fluid.component"],changeApplierOptions:{relayStyle:!0,cullUnchanged:!0},members:{model:"@expand:fluid.initRelayModel({that}, {that}.modelRelay)",applier:"@expand:fluid.makeHolderChangeApplier({that}, {that}.options.changeApplierOptions)",modelRelay:"@expand:fluid.establishModelRelay({that}, {that}.options.model, {that}.options.modelListeners, {that}.options.modelRelay, {that}.applier)"},mergePolicy:{model:{noexpand:!0,func:b.arrayConcatPolicy},modelListeners:b.makeMergeListenersPolicy(b.arrayConcatPolicy),modelRelay:b.makeMergeListenersPolicy(b.arrayConcatPolicy,!0)}}),b.defaults("fluid.priorityHolder",{gradeNames:"fluid.component",members:{priorities:"@expand:fluid.priorityHolder.expand({that}.options.priorities)"}}),b.priorityHolder.expand=function(a){var c=b.parsePriorityRecords(a,"priorityHolder entry",!0),d={};return b.each(c,function(a,b){d[a.namespace]=10*-b}),d},b.modelChangedToChange=function(a){return{value:a[0],oldValue:a[1],path:a[2],transaction:a[4]}},b.event.invokeListener=function(a,c,d,e){return"string"==typeof a&&(a=b.event.resolveListener(a)),a.apply(null,c,d,e)},b.resolveModelListener=function(a,c){var d=function(){if(!b.isDestroyed(a)){var d=b.modelChangedToChange(arguments),e=arguments,f={change:d,arguments:e},g={source:Object.keys(d.transaction.sources)};c.args&&(e=b.expandOptions(c.args,a,{},f)),b.event.invokeListener(c.listener,b.makeArray(e),f,g)}};return b.event.impersonateListener(c.listener,d),d},b.registerModelListeners=function(a,c,d,e){var f=b.resolveModelListener(a,c);b.each(c.byTarget,function(d){function g(){if(b.isModelComplete(h.that)){var c=h.applier.initiate(null,"init");b.initModelEvent(a,h.applier,c,[i]),c.commit()}}var h=d[0],i={listener:f,listenerId:b.allocateGuid(),segsArray:b.getMembers(d,"modelSegs"),pathArray:b.getMembers(d,"path"),includeSource:c.includeSource,excludeSource:c.excludeSource,priority:b.expandOptions(c.priority,a),transactional:!0};if(i=h.applier.modelChanged.addListener(i,f,e,c.softNamespace),b.recordChangeListener(a,h.applier,f,i.listenerId),a!==h.that&&!b.isModelComplete(a)){var j=b.getForComponent(a,["events","onCreate"]);j.addListener(g)}})},b.mergeModelListeners=function(a,c){b.each(c,function(c,d){"string"==typeof c&&(c={funcName:c});var e=b.event.resolveListenerRecord(c,a,"modelListeners",null,!1).records;b.each(e,function(c){c.byTarget={};var e=b.makeArray(void 0===c.path?d:c.path);b.each(e,function(d){var e=b.parseValidModelReference(a,"modelListeners entry",d);b.pushArray(c.byTarget,e.that.id,e)});var f=(c.namespace&&!c.softNamespace?c.namespace:null)||(void 0!==c.path?d:null);b.registerModelListeners(a,c,e,f)})})},b.fireChanges=function(a,b){for(var c=0;c<b.length;++c)a.fireChangeRequest(b[c])},b.model.isChangedPath=function(a,b){for(var c=0;c<=b.length;++c){if("string"==typeof a)return!0;c<b.length&&a&&(a=a[b[c]])}return!1},b.model.setChangedPath=function(a,c,d){var e=function(e){c.unshift(e),b.model.setSimple(a,c,d),c.shift()};b.model.isChangedPath(a.changeMap,c)||(++a.changes,e("changeMap")),b.model.isChangedPath(a.deltaMap,c)||(++a.deltas,e("deltaMap"))},b.model.fetchChangeChildren=function(a,c,d,e,f){b.each(e,function(e,g){d[c]=g,b.model.applyChangeStrategy(a,g,c,d,e,f),d.length=c})},b.model.isSameValue=function(a,b){if("number"!=typeof a||"number"!=typeof b)return a===b;if(a===b||a!==a&&b!==b)return!0;var c=Math.abs((a-b)/b);return 1e-12>c},b.model.applyChangeStrategy=function(a,c,d,e,f,g){var h=a[c],i=b.typeCode(f),j=b.typeCode(h),k=b.NO_VALUE;"primitive"===i?b.model.isSameValue(h,f)||(k=f,++g.unchanged):(j!==i||"array"===i&&f.length!==h.length)&&(k=b.freshContainer(f)),k!==b.NO_VALUE&&(a[c]=k,g.changeMap&&b.model.setChangedPath(g,e,g.inverse?"DELETE":"ADD")),"primitive"!==i&&b.model.fetchChangeChildren(a[c],d+1,e,f,g)},b.model.stepTargetAccess=function(a,c,d,e,f,g){for(var h=e;f>h;++h)if(a){var i=a[d[h]];a=b.model.traverseWithStrategy(a,d,h,g["ADD"===c?"resolverSetConfig":"resolverGetConfig"],d.length-h-1),i!==a&&g.changeMap&&b.model.setChangedPath(g,d.slice(0,h+1),"ADD")}return{root:a,last:d[f]}},b.model.defaultAccessorConfig=function(a){return a=a||{},a.resolverSetConfig=a.resolverSetConfig||b.model.escapedSetConfig,a.resolverGetConfig=a.resolverGetConfig||b.model.escapedGetConfig,a},b.model.applyHolderChangeRequest=function(a,c,d){d=b.model.defaultAccessorConfig(d),d.deltaMap=d.changeMap?{}:null,d.deltas=0;var e,f=c.segs.length,g=0===f;if(g?e={root:a,last:"model"}:(a.model||(a.model={},b.model.setChangedPath(d,[],d.inverse?"DELETE":"ADD")),e=b.model.stepTargetAccess(a.model,c.type,c.segs,0,f-1,d)),"ADD"===c.type){var h=c.value,i=b.makeArray(c.segs);b.model.applyChangeStrategy(e.root,e.last,f-1,i,h,d,g)}else"DELETE"===c.type?e.root&&void 0!==e.root[e.last]&&(delete e.root[e.last],d.changeMap&&b.model.setChangedPath(d,c.segs,"DELETE")):b.fail("Unrecognised change type of "+c.type);return d.deltas?d.deltaMap:null},b.model.diff=function(a,c,d){d=d||{changes:0,unchanged:0,changeMap:{}};var e,f=b.typeCode(a),g=b.typeCode(c);if("primitive"===f&&"primitive"===g)e=b.model.isSameValue(a,c);else if("primitive"===f^"primitive"===g)e=!1;else{var h={model:b.copy(a)};b.model.applyHolderChangeRequest(h,{value:c,segs:[],type:"ADD"},d);var i={model:b.copy(c)};d.inverse=!0,b.model.applyHolderChangeRequest(i,{value:a,segs:[],type:"ADD"},d),e=0===d.changes}return e===!1&&0===d.changes?(d.changes=1,d.changeMap=void 0===c?"DELETE":"ADD"):e===!0&&0===d.unchanged&&(d.unchanged=1),e},b.matchChanges=function(a,c,d){for(var e=d.model,f=a,g=["model"],h=!1,i=[],j=0;j<c.length;++j){var k=c[j];"*"===k?j===c.length-1?h=!0:b.fail("Wildcard specification in modelChanged listener is only supported for the final path segment: "+c.join(".")):(g.push(k),f=b.isPrimitive(f)?f:f[k],e=e?e[k]:void 0)}return f&&(h?b.each(e,function(a,b){i.push(g.concat(b))}):i.push(g)),i},b.storeExternalChange=function(a,b,c,d,e){var f=b.composeSegments.apply(null,c),g=[b.holder.id,d.listenerId,d.wildcard?f:""],h=g.join("|");a.externalChanges[h]={listener:d.listener,namespace:d.namespace,priority:d.priority,args:e}},b.notifyModelChanges=function(a,c,d,e,f,g,h,i){for(var j=g&&b.getModelTransactionRec(i,g.id),k=0;k<a.length;++k)for(var l=a[k],m=l.segsArray.length>1,n=0;n<l.segsArray.length;++n)for(var o=b.matchChanges(c,l.segsArray[n],d),p=0;p<o.length;++p){if(h.destroyed)return;var q=o[p];l.listener=b.event.resolveListener(l.listener);var r=[m?d.model:b.model.getSimple(d,q),m?e.model:b.model.getSimple(e,q),m?[]:q.slice(1),f,g,h];if(!l.isRelay){var s=b.model.diff(r[0],r[1]);if(s)continue;var t=b.isExcludedChangeSource(g,l);if(t)continue}j&&!l.isRelay&&l.transactional?b.storeExternalChange(j,h,q,l,r):l.listener.apply(null,r)}},b.bindELMethods=function(a){a.parseEL=function(c){return b.model.pathToSegments(c,a.options.resolverSetConfig)},a.composeSegments=function(){return a.options.resolverSetConfig.parser.compose.apply(null,arguments)}},b.initModelEvent=function(a,c,d,e){b.notifyModelChanges(e,"ADD",d.oldHolder,b.emptyHolder,null,d,c,a)},b.emptyHolder=b.freezeRecursive({model:void 0}),b.preFireChangeRequest=function(a,b){b.type||(b.type="ADD"),b.segs=b.segs||a.parseEL(b.path)},b.bindRequestChange=function(a){a.change=function(b,c,d,e){var f={path:b,value:c,type:d,source:e};a.fireChangeRequest(f)}},b.isObjectSimple=function(a){return"[object Object]"===Object.prototype.toString.call(a)},b.mergeChangeSources=function(a,c){b.isObjectSimple(c)?b.extend(a,c):b.each(b.makeArray(c),function(b){a[b]=!0})},b.ChangeApplier=function(){},b.makeHolderChangeApplier=function(c,d){d=b.model.defaultAccessorConfig(d);var e=b.allocateGuid(),f=new b.ChangeApplier;return a.extend(f,{applierId:e,holder:c,changeListeners:{listeners:[],transListeners:[]},options:d,modelChanged:{},preCommit:b.makeEventFirer({name:"preCommit event for ChangeApplier "}),postCommit:b.makeEventFirer({name:"postCommit event for ChangeApplier "})}),f.destroy=function(){f.preCommit.destroy(),f.postCommit.destroy(),f.destroyed=!0},f.modelChanged.addListener=function(a,c,d,e){a="string"==typeof a?{path:a,listenerId:b.event.identifyListener(c)}:b.copy(a),a.listenerId=a.listenerId||b.event.identifyListener(c),a.namespace=d,a.softNamespace=e,"string"==typeof c&&(c={globalName:c}),a.listener=c,a.transactional!==!1&&(a.transactional=!0),a.segsArray||(void 0!==a.path&&(a.segs=a.segs||f.parseEL(a.path)),a.segsArray||(a.segsArray=[a.segs]));var g=f.changeListeners[a.transactional?"transListeners":"listeners"];return b.parseSourceExclusionSpec(a,a),a.wildcard=b.accumulate(b.transform(a.segsArray,function(a){return b.contains(a,"*")}),b.add,0),a.wildcard&&a.segsArray.length>1&&b.fail("Error in model listener specification ",a," - you may not supply a wildcard pattern as one of a set of multiple paths to be matched"),a.priority=b.parsePriority(a.priority,g.length,!1,"model listener"),g.push(a),a},f.modelChanged.removeListener=function(a){var c=b.event.identifyListener(a),d="string"==typeof a?a:null,e=function(a){return a.listenerId===c||a.listenerId===d||d&&a.namespace===d};b.remove_if(f.changeListeners.listeners,e),b.remove_if(f.changeListeners.transListeners,e)},f.fireChangeRequest=function(a){var b=f.initiate("local",a.source);b.fireChangeRequest(a),b.commit()},f.initiate=function(a,e,g){a="init"===e?null:a||"local";var h="relay"===a,i={instanceId:b.allocateGuid(),id:g||b.allocateGuid(),changeRecord:{resolverSetConfig:d.resolverSetConfig,resolverGetConfig:d.resolverGetConfig},reset:function(){i.oldHolder=c,i.newHolder={model:b.copy(c.model)},i.changeRecord.changes=0,i.changeRecord.unchanged=0,i.changeRecord.changeMap={}},commit:function(a){if(f.preCommit.fire(i,f,a),i.changeRecord.changes>0){var d={model:c.model};c.model=i.newHolder.model,b.notifyModelChanges(f.changeListeners.transListeners,i.changeRecord.changeMap,c,d,null,i,f,c)}h||f.postCommit.fire(i,f,a)},fireChangeRequest:function(a){b.preFireChangeRequest(f,a),a.transactionId=i.id;var d=b.model.applyHolderChangeRequest(i.newHolder,a,i.changeRecord);b.notifyModelChanges(f.changeListeners.listeners,d,i.newHolder,c,a,i,f,c)},hasChangeSource:function(a){return i.fullSources[a]}},j=b.getModelTransactionRec(c,i.id);return j&&(b.mergeChangeSources(j.sources,e),i.sources=j.sources,i.fullSources=Object.create(j.sources),i.fullSources[a]=!0),i.reset(),b.bindRequestChange(i),i},b.bindRequestChange(f),b.bindELMethods(f),f}}(jQuery,fluid_2_0_0);var fluid=fluid||require("infusion"),berg=fluid.registerNamespace("berg");!function(){"use strict";fluid.defaults("berg.clock",{gradeNames:["fluid.component"],freq:1,members:{time:0,freq:"{that}.options.freq",tickDuration:{expander:{funcName:"berg.clock.calcTickDuration",args:"{that}.freq"}}},invokers:{start:"fluid.identity()",tick:"fluid.notImplemented()",stop:"fluid.identity()"},events:{onTick:null},listeners:{onDestroy:["{that}.stop()"]}}),berg.clock.calcTickDuration=function(a){return 1/a},fluid.defaults("berg.clock.offline",{gradeNames:["berg.clock"],invokers:{tick:{funcName:"berg.clock.offline.tick",args:["{that}"]}}}),berg.clock.offline.tick=function(a){a.time=a.time+a.tickDuration,a.events.onTick.fire(a.time,a.freq)},fluid.defaults("berg.clock.realtime",{gradeNames:["berg.clock"],members:{time:"@expand:berg.clock.realtime.now()"},invokers:{tick:{funcName:"berg.clock.realtime.tick",args:["{that}"]}}}),berg.clock.realtime.now=function(){return performance.now()/1e3},"undefined"==typeof performance&&(berg.clock.realtime.now=function(){return Date.now()/1e3}),berg.clock.realtime.tick=function(a){a.time=berg.clock.realtime.now(),a.events.onTick.fire(a.time,a.freq)}}();var fluid=fluid||require("infusion"),berg=fluid.registerNamespace("berg");!function(){"use strict";fluid.registerNamespace("berg"),berg.priorityQueue=function(){var a={items:[]};return a.push=function(b){if(b){if(void 0===b.priority)throw new Error("An item without a priority cannot be added to the queue.");a.items.push(b),a.bubbleUp(a.items.length-1)}},a.peek=function(){return a.items[0]},a.pop=function(){var b=a.items[0],c=a.items.pop();return a.items.length>0&&(a.items[0]=c,a.sinkDown(0)),b},a.remove=function(b){for(var c=a.items.length,d=0;c>d;d++)if(a.items[d]===b){var e=a.items.pop();if(d===c-1)break;a.items[d]=e,a.bubbleUp(d),a.sinkDown(d);break}},a.size=function(){return a.items.length},a.clear=function(){a.items.length=0},a.bubbleUp=function(b){for(var c=a.items[b];b>0;){var d=b-1>>1,e=a.items[d];if(e.priority<=c.priority)break;a.items[d]=c,a.items[b]=e,b=d}},a.sinkDown=function(b){for(var c,d=a.items.length,e=a.items[b];;){var f=2*(b+1),g=f-1,h=null;if(d>g&&(c=a.items[g],c.priority<e.priority&&(h=g)),d>f){var i=a.items[f],j=null===h?e:c;i.priority<j.priority&&(h=f)}if(null===h)break;a.items[b]=a.items[h],a.items[h]=e,b=h}},a}}();var fluid=fluid||require("infusion"),berg=fluid.registerNamespace("berg");!function(){"use strict";berg.getGlobalSelf=function(){return self},fluid.defaults("berg.postMessageSender",{gradeNames:["fluid.component"],members:{messageTarget:"@expand:berg.getGlobalSelf()"},invokers:{postMessage:"berg.postMessageSender.postMessage({arguments}.0, {arguments}.1, {that}.messageTarget)"}}),berg.postMessageSender.postMessage=function(a,b,c){if("string"!=typeof a)throw new Error("Can't post a message without a message type.");var d={type:a,args:b};c.postMessage(d)},fluid.defaults("berg.postMessageListener",{gradeNames:["fluid.component"],members:{messageSource:"@expand:berg.getGlobalSelf()"},events:{onError:null},listeners:{onCreate:["berg.postMessageListener.bind({that})"],onError:[{namespace:"failOnError",funcName:"fluid.fail"}]}}),berg.postMessageListener.bind=function(a){a.messageSource.addEventListener("message",function(b){var c=b.data;c.type||a.events.onError.fire("Received a remote message without a type. "+fluid.prettyPrintJSON(c));var d=a[c.type];a.options.invokers[c.type]&&d||a.events.onError.fire("Received a message of type "+c.type+", which did not resolve to a component invoker. Invokers: "+fluid.prettyPrintJSON(a.options.invokers));var e=fluid.makeArray(c.args);d.apply(null,e)},!1)}}();var fluid=fluid||require("infusion"),berg=fluid.registerNamespace("berg");!function(){"use strict";fluid.defaults("berg.scheduler",{gradeNames:["fluid.modelComponent"],members:{queue:"@expand:berg.priorityQueue()",lookahead:"@expand:berg.scheduler.calcLookahead({clock})"},model:{timeScale:1},components:{clock:{type:"berg.clock.offline"}},invokers:{start:"{clock}.start()",stop:"{clock}.stop()",tick:"berg.scheduler.tick({arguments}.0, {that})",schedule:"berg.scheduler.schedule({arguments}.0, {that})",once:"berg.scheduler.once({arguments}.0, {arguments}.1, {that})",repeat:{funcName:"berg.scheduler.repeat",args:["{arguments}.0","{arguments}.1","{arguments}.2","{arguments}.3","{that}"]},clear:"{that}.queue.remove({arguments}.0)",clearAll:"{that}.queue.clear()",setTimeScale:{changePath:"timeScale",value:"{arguments}.0"},scheduleEvent:{funcName:"berg.scheduler.scheduleEvent",args:["{arguments}.0","{that}"]},invokeCallback:{funcName:"berg.scheduler.invokeCallback",args:["{arguments}.0","{arguments}.1"]}},modelListeners:{timeScale:{funcName:"berg.scheduler.scaleEventTimes",args:["{that}.queue","{change}.value"],excludeSource:"init"}},listeners:{"{clock}.events.onTick":{func:"{scheduler}.tick"}}}),berg.scheduler.calcLookahead=function(a){return a.tickDuration/2},berg.scheduler.calcPriority=function(a,b,c){return a+b*c},berg.scheduler.scaleEventTimes=function(a,b){for(var c=0;c<a.items.length;c++){var d=a.items[c];d.priority=berg.scheduler.calcPriority(d.scheduledAt,d.time,b)}},berg.scheduler.expandRepeatingEventSpec=function(a,b){"number"!=typeof b.time&&(b.time=0),b.interval=1/b.freq,b.end="number"!=typeof b.end?1/0:b.end+a},berg.scheduler.validateEventSpec=function(a){if("repeat"===a.type&&"number"!=typeof a.freq)throw new Error("No freq was specified for scheduled event: "+fluid.prettyPrintJSON(a));if("number"!=typeof a.time)throw new Error("No time was specified for scheduled event: "+fluid.prettyPrintJSON(a))},berg.scheduler.invokeCallback=function(a,b){b.callback(a,b)},berg.scheduler.evaluateScoreEvent=function(a,b,c){c.invokeCallback(a,b),"repeat"===b.type&&b.end>a&&(b.priority=berg.scheduler.calcPriority(a,b.interval,c.model.timeScale),c.queue.push(b))},berg.scheduler.expandEventSpec=function(a){a.type||(a.type="once"),a.id||(a.id=fluid.allocateGuid())},berg.scheduler.scheduleEvent=function(a,b){var c=b.clock.time,d=b.model.timeScale;return berg.scheduler.expandEventSpec(a),"repeat"===a.type&&berg.scheduler.expandRepeatingEventSpec(c,a),"number"!=typeof a.scheduledAt&&(a.scheduledAt=c),berg.scheduler.validateEventSpec(a),a.priority=berg.scheduler.calcPriority(c,a.time,d),a.priority<=c?berg.scheduler.evaluateScoreEvent(c,a,b):b.queue.push(a),a},berg.scheduler.scheduleEvents=function(a,b){return a.forEach(function(a){b.scheduleEvent(a)}),a},berg.scheduler.schedule=function(a,b){return fluid.isArrayable(a)?berg.scheduler.scheduleEvents(a,b):b.scheduleEvent(a)},berg.scheduler.once=function(a,b,c){var d={type:"once",time:a,callback:b};return c.scheduleEvent(d)},berg.scheduler.repeat=function(a,b,c,d,e){var f={type:"repeat",freq:a,time:c,end:d,callback:b};return e.scheduleEvent(f)},berg.scheduler.tick=function(a,b){for(var c=b.queue.peek();c&&c.priority<=a+b.lookahead;)b.queue.pop(),berg.scheduler.evaluateScoreEvent(a,c,b),c=b.queue.peek()}}();var fluid=fluid||require("infusion"),berg=fluid.registerNamespace("berg");!function(){"use strict";fluid.defaults("berg.scheduler.postMessage",{gradeNames:["berg.postMessageListener","berg.postMessageSender","berg.scheduler"],invokers:{invokeCallback:{funcName:"berg.scheduler.postMessage.post",args:["invokeCallback",["{arguments}.0","{arguments}.1"],"{that}"]}}}),berg.scheduler.postMessage.post=function(a,b,c){c.postMessage(a,b)},fluid.defaults("berg.scheduler.workerProxy",{gradeNames:["berg.scheduler","berg.postMessageListener","berg.postMessageSender"],scriptPath:"../../dist/bergson-all-worker.js",remoteSchedulerOptions:{components:{clock:{type:"berg.clock.setInterval",options:{freq:.01}}}},members:{eventSpecMap:{},worker:"@expand:berg.scheduler.workerProxy.createWorker({that}.options.scriptPath)",messageTarget:"{that}.worker",messageSource:"{that}.worker"},components:{clock:{type:"berg.clock.offline"}},invokers:{start:"{that}.postMessage(start)",stop:"{that}.postMessage(stop)",tick:"fluid.identity()",invokeCallback:"berg.scheduler.workerProxy.invokeCallback({arguments}.0, {arguments}.1, {that})",scheduleEvent:"berg.scheduler.workerProxy.scheduleEvent({arguments}.0, {that})",clear:"{that}.postMessage(clear, {arguments}.0)",clearAll:"{that}.postMessage(clearAll)",setTimeScale:"{that}.postMessage(setTimeScale, {arguments}.0)"},listeners:{onCreate:[{func:"{that}.postMessage",args:["create",["berg.scheduler.postMessage","{that}.options.remoteSchedulerOptions"]]}],onDestroy:[{"this":"{that}.worker",method:"terminate"}]}}),berg.scheduler.workerProxy.createWorker=function(a){return new Worker(a)},berg.scheduler.workerProxy.invokeCallback=function(a,b,c){var d=c.eventSpecMap[b.id],e=d.callback;"function"==typeof e?e(a,b):c.events.onError.fire("A callback function was not found for score event: "+fluid.prettyPrintJSON(d))},berg.scheduler.workerProxy.makeTransferrableCopy=function(a){var b=fluid.copy(a);return delete b.callback,b},berg.scheduler.workerProxy.scheduleEvent=function(a,b){berg.scheduler.expandEventSpec(a),b.eventSpecMap[a.id]=a;var c=berg.scheduler.workerProxy.makeTransferrableCopy(a);b.postMessage("scheduleEvent",c)}}();var fluid=fluid||require("infusion"),berg=fluid.registerNamespace("berg");!function(){"use strict";fluid.defaults("berg.clock.raf",{gradeNames:["berg.clock.realtime"],freq:60,members:{requestID:null},invokers:{start:{funcName:"berg.clock.raf.requestNextTick",args:["{that}"]},tick:{funcName:"berg.clock.raf.tick",args:["{that}","{arguments}.0"]},stop:{funcName:"berg.clock.raf.stop",args:["{that}"]}}}),berg.clock.raf.requestNextTick=function(a){a.requestID=requestAnimationFrame(a.tick)},berg.clock.raf.tick=function(a,b){berg.clock.raf.requestNextTick(a);var c=b/1e3;a.time=c,a.events.onTick.fire(c,a.freq)},berg.clock.raf.stop=function(a){cancelAnimationFrame(a.requestID)}}();var fluid=fluid||require("infusion"),berg=fluid.registerNamespace("berg");!function(){"use strict";fluid.defaults("berg.clock.setInterval",{gradeNames:["berg.clock.realtime"],freq:10,members:{intervalID:null},invokers:{start:{funcName:"berg.clock.setInterval.start",args:["{that}"]},stop:{funcName:"berg.clock.setInterval.stop",args:["{that}"]}}}),berg.clock.setInterval.start=function(a){a.intervalID=setInterval(a.tick,1e3/a.freq)},berg.clock.setInterval.stop=function(a){clearInterval(a.intervalID)}}();var fluid=fluid||require("infusion"),berg=fluid.registerNamespace("berg");!function(){"use strict";fluid.defaults("berg.clock.logger",{gradeNames:["fluid.component"],numTicksToLog:72e3,members:{tickCounter:0,lastTickTime:null,interval:0,intervalLog:"@expand:berg.clock.logger.initLog({that}.options.numTicksToLog)"},invokers:{log:"berg.clock.logger.log({that}, {clock})"},listeners:{"{clock}.events.onTick":["{that}.log()"]}}),berg.clock.logger.initLog=function(a){return new Float32Array(a)},berg.clock.logger.log=function(a,b){return null===a.lastTickTime?void(a.lastTickTime=b.time):void(a.tickCounter<a.options.numTicksToLog&&(a.tickCounter++,a.interval=b.time-a.lastTickTime,a.lastTickTime=b.time,a.intervalLog[a.tickCounter]=a.interval))}}(),function(){"use strict";self.addEventListener("message",function(a){"create"===a.data.type&&(self.activeComponent&&self.activeComponent.destroy(),self.activeComponent=fluid.invokeGlobalFunction(a.data.args[0],[a.data.args[1]]),a.stopPropagation())},!0)}();